<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Rule Creation Wizard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #064e3b 0%, #022c22 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .wizard-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .wizard-header {
            background: linear-gradient(135deg, #064e3b 0%, #022c22 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .wizard-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .wizard-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .progress-bar {
            display: flex;
            padding: 20px 30px;
            background: #f0fdf4;
            border-bottom: 1px solid #86efac;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .progress-step:hover::before {
            transform: scale(1.1);
        }

        .progress-step:hover span {
            color: #059669;
        }

        .progress-step::before {
            content: attr(data-step);
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            background: #cbd5e1;
            border-radius: 50%;
            font-weight: bold;
            color: #64748b;
            margin-bottom: 5px;
        }

        .progress-step.active::before {
            background: #064e3b;
            color: white;
        }

        .progress-step.completed::before {
            background: #059669;
            color: white;
            content: "✓";
        }

        .progress-step span {
            display: block;
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }

        .wizard-content {
            padding: 40px;
            min-height: 400px;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-title {
            font-size: 24px;
            color: #0f172a;
            margin-bottom: 10px;
        }

        .step-description {
            color: #64748b;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .three-column-layout {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required {
            color: #dc2626;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #064e3b;
            box-shadow: 0 0 0 3px rgba(6, 78, 59, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .help-text {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }

        .example-box {
            background: #ecfdf5;
            border-left: 4px solid #064e3b;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .example-box strong {
            color: #022c22;
            display: block;
            margin-bottom: 5px;
        }

        .example-box code {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 13px;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-prev {
            background: #e2e8f0;
            color: #1e293b;
        }

        .btn-prev:hover {
            background: #cbd5e1;
        }

        .btn-next {
            background: #064e3b;
            color: white;
        }

        .btn-next:hover {
            background: #022c22;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(6, 78, 59, 0.3);
        }

        .btn-generate {
            background: linear-gradient(135deg, #064e3b 0%, #022c22 100%);
            color: white;
        }

        .btn-generate:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 20px rgba(6, 78, 59, 0.4);
        }

        .json-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .copy-button {
            margin-top: 15px;
            background: #059669;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .copy-button:hover {
            background: #047857;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f8fafc;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .checkbox-item:hover {
            background: #ecfdf5;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .checkbox-item label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }

        .add-button {
            background: #064e3b;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .add-button:hover {
            background: #022c22;
        }

        .dynamic-list {
            margin-top: 10px;
        }

        .dynamic-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .dynamic-item select,
        .dynamic-item input {
            flex: 1;
        }

        .remove-button {
            background: #dc2626;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }

        .remove-button:hover {
            background: #b91c1c;
        }

        .variable-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            padding: 15px;
            background: #f0fdf4;
            border-radius: 8px;
            border: 1px solid #86efac;
        }

        .chip {
            background: white;
            border: 1px solid #064e3b;
            color: #022c22;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Courier New', monospace;
            position: relative;
        }

        .chip:hover {
            background: #064e3b;
            color: white;
            transform: scale(1.05);
        }

        .chip.copied {
            animation: chipFlash 0.5s;
        }

        @keyframes chipFlash {
            0% { background: white; border-color: #064e3b; color: #022c22; }
            50% { background: #059669; border-color: #059669; color: white; }
            100% { background: white; border-color: #064e3b; color: #022c22; }
        }

        .chip.copied::after {
            content: "✓ Copied!";
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            animation: fadeInOut 1s forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .chip-section {
            width: 100%;
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: 600;
            border-bottom: 1px solid #86efac;
            padding-bottom: 5px;
        }

        .chip-section:first-child {
            margin-top: 0;
        }

        .common-expressions-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #86efac;
        }

        .expression-title {
            font-size: 14px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e293b;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            animation: slideIn 0.3s;
            z-index: 1000;
        }

        .toast.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .section-header {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #064e3b;
        }

        .event-filtering-section {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .event-filtering-section .three-column-layout {
            margin-bottom: 10px;
        }

        .event-filtering-section .form-group {
            margin-bottom: 12px;
        }

        .family-description {
            background: #ecfdf5;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
            color: #334155;
            font-style: italic;
            display: none;
        }

        .family-description.show {
            display: block;
        }

        .required-fields-section {
            background: #f0fdf4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .required-fields-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .field-checkbox {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            background: white;
            border: 1px solid #064e3b;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .field-checkbox:hover {
            background: #ecfdf5;
        }

        .field-checkbox input[type="checkbox"] {
            margin-right: 6px;
            cursor: pointer;
        }

        .field-checkbox label {
            margin: 0;
            font-size: 13px;
            font-weight: normal;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="wizard-card">
            <div class="wizard-header">
                <h1>New-Scale Analytics Anomaly Rule Creation Wizard</h1>
                <p>Create custom threat detection rule for Exabeam NSA anomaly detection engine</p>
            </div>

            <div class="progress-bar">
                <div class="progress-step active" data-step="1">
                    <span>Rule Type</span>
                </div>
                <div class="progress-step" data-step="2">
                    <span>Basic Info</span>
                </div>
                <div class="progress-step" data-step="3">
                    <span>Detection</span>
                </div>
                <div class="progress-step" data-step="4">
                    <span>Event Filters</span>
                </div>
                <div class="progress-step" data-step="5">
                    <span>Advanced</span>
                </div>
                <div class="progress-step" data-step="6">
                    <span>Review</span>
                </div>
            </div>

            <div class="wizard-content">
                <!-- Step 1: Rule Type Selection -->
                <div class="step active" id="step1">
                    <h2 class="step-title">Choose Rule Type</h2>
                    <p class="step-description">Select the type of analytics rule that best fits your detection needs.</p>
                    
                    <div class="form-group">
                        <label>Rule Type <span class="required">*</span></label>
                        <select id="ruleType" required>
                            <option value="">Select a rule type...</option>
                            <option value="profiledFeature">Profiled Feature - First-time Activity Detection</option>
                            <option value="factFeature">Fact Feature - Known Malicious Patterns</option>
                            <option value="contextFeature">Context Feature - Contextual Data Analysis</option>
                            <option value="numericCountProfiledFeature">Numeric Count - Frequency Anomalies</option>
                            <option value="numericDistinctCountProfiledFeature">Numeric Distinct Count - Unique Count Anomalies</option>
                            <option value="numericSumProfiledFeature">Numeric Sum - Rate Tracking</option>
                        </select>
                        <div class="help-text">Each rule type serves a different purpose in threat detection.</div>
                    </div>

                    <div class="example-box" id="ruleTypeExample" style="display:none;">
                        <strong>Example Use Case:</strong>
                        <div id="exampleContent"></div>
                    </div>
                </div>

                <!-- Step 2: Basic Information & Classification -->
                <div class="step" id="step2">
                    <h2 class="step-title">Basic Rule Information & Classification</h2>
                    <p class="step-description">Provide basic information and classification for your rule.</p>
                    
                    <div class="form-group">
                        <label>Rule Name <span class="required">*</span></label>
                        <input type="text" id="ruleName" placeholder="e.g., First login from unusual location" maxlength="256" required>
                        <div class="help-text">A clear, descriptive name for your rule (max 256 characters)</div>
                    </div>

                    <div class="form-group">
                        <label>Description <span class="required">*</span></label>
                        <textarea id="ruleDescription" placeholder="Describe what this rule detects and why it's important..." maxlength="1024" required></textarea>
                        <div class="help-text">Required description to help others understand the rule (max 1024 characters)</div>
                    </div>

                    <div class="section-header">Rule Classification</div>
                    <div class="form-group">
                        <label>Rule Family <span class="required">*</span></label>
                        <select id="familyId" required>
                            <option value="">Select rule family...</option>
                        </select>
                        <div class="family-description" id="familyDescription"></div>
                    </div>

                    <div class="form-group">
                        <label>Rule Group <span class="required">*</span></label>
                        <select id="ruleGroupId" required>
                            <option value="">Select rule group...</option>
                        </select>
                        <div class="help-text">Groups are filtered based on selected family</div>
                    </div>

                    <div class="form-group">
                        <label>Template ID</label>
                        <input type="text" id="templateId" placeholder="Auto-generated if left empty">
                        <div class="help-text">Format: C_[RuleType]-[Scope]-[Feature]-[Activity]. Will be auto-generated if empty.</div>
                    </div>

                    <div class="section-header">Use Case Classification</div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc1" value="Abnormal Authentication & Access">
                                <label for="uc1">Abnormal Authentication & Access</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc2" value="Account Manipulation">
                                <label for="uc2">Account Manipulation</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc3" value="Audit Tampering">
                                <label for="uc3">Audit Tampering</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc4" value="Brute Force Attack">
                                <label for="uc4">Brute Force Attack</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc5" value="Cloud Data Protection">
                                <label for="uc5">Cloud Data Protection</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc6" value="Compromised Credentials">
                                <label for="uc6">Compromised Credentials</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc7" value="Data Exfiltration">
                                <label for="uc7">Data Exfiltration</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc8" value="Lateral Movement">
                                <label for="uc8">Lateral Movement</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc9" value="Malware">
                                <label for="uc9">Malware</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc10" value="Phishing">
                                <label for="uc10">Phishing</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc11" value="Privilege Escalation">
                                <label for="uc11">Privilege Escalation</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc12" value="Ransomware">
                                <label for="uc12">Ransomware</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc13" value="Data Access">
                                <label for="uc13">Data Access</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc14" value="Data Leak">
                                <label for="uc14">Data Leak</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="uc15" value="Privilege Abuse">
                                <label for="uc15">Privilege Abuse</label>
                            </div>
                        </div>
                    </div>

                    <div class="section-header">MITRE ATT&CK Mapping</div>
                    <div class="form-group">
                        <button type="button" class="add-button" onclick="addMitreMapping()">+ Add MITRE Technique</button>
                        <div id="mitreMappings" class="dynamic-list"></div>
                    </div>
                </div>

                <!-- Step 3: Detection Configuration -->
                <div class="step" id="step3">
                    <h2 class="step-title">Detection Configuration</h2>
                    <p class="step-description">Configure detection parameters and scope for your rule.</p>
                    
                    <div class="form-group">
                        <label>Detection Reason <span class="required">*</span></label>
                        <input type="text" id="detectionReason" placeholder="e.g., First login to ${entity.device.dest} from ${trigger.feature_value}" required>
                        <div class="help-text">Dynamic message shown when rule triggers. Click variables below to copy to clipboard:</div>
                        
                        <div class="variable-chips">
                            <div class="chip-section">Event Variables</div>
                            <span class="chip" data-copy="${event.user}">${event.user}</span>
                            <span class="chip" data-copy="${event.src_ip}">${event.src_ip}</span>
                            <span class="chip" data-copy="${event.dest_ip}">${event.dest_ip}</span>
                            <span class="chip" data-copy="${event.file_name}">${event.file_name}</span>
                            <span class="chip" data-copy="${event.process_name}">${event.process_name}</span>
                            <span class="chip" data-copy="${event.bucket_name}">${event.bucket_name}</span>
                            <span class="chip" data-copy="${event.app_name}">${event.app_name}</span>
                            
                            <div class="chip-section">Entity Variables</div>
                            <span class="chip" data-copy="${entity.user.source}">${entity.user.source}</span>
                            <span class="chip" data-copy="${entity.device.source}">${entity.device.source}</span>
                            <span class="chip" data-copy="${entity.device.dest}">${entity.device.dest}</span>
                            
                            <div class="chip-section">Trigger Variables</div>
                            <span class="chip" data-copy="${trigger.feature_value}">${trigger.feature_value}</span>
                            <span class="chip" data-copy="${trigger.scope_value}">${trigger.scope_value}</span>
                            <span class="chip" data-copy="${trigger.numeric_value}">${trigger.numeric_value}</span>
                        </div>
                    </div>

                    <div id="profiledFeatureFields" style="display:none;">
                        <div class="two-column-layout">
                            <div class="form-group">
                                <label>Scope Value <span class="required">*</span></label>
                                <input type="text" id="scopeValue" placeholder="e.g., EntityId('type: User && direction: Source')">
                                <div class="help-text">The entity or attribute to track</div>
                            </div>

                            <div class="form-group">
                                <label>Feature Value <span class="required">*</span></label>
                                <input type="text" id="featureValue" placeholder="e.g., dest_ip or platform">
                                <div class="help-text">The attribute being evaluated</div>
                            </div>
                        </div>

                        <div id="numericSettings" style="display:none;">
                            <div class="section-header">Numeric Feature Settings</div>
                            <div class="two-column-layout">
                                <div class="form-group">
                                    <label>Count Per</label>
                                    <input type="text" id="countPer" placeholder="e.g., EntityId('type: User && direction: Source')">
                                    <div class="help-text">Entity to count per (for numeric features)</div>
                                </div>
                                <div class="form-group">
                    <label>Query <span class="required">*</span></label>
                    <input type="text" id="queryField" placeholder="e.g., (activity_type = 'endpoint-login' AND outcome = 'success')">
                    <div class="help-text">Custom query for numeric features</div>
                </div>
                            </div>
                            <div class="two-column-layout">
                                <div class="form-group">
                                    <label>Window Duration</label>
                                    <input type="text" id="windowDuration" value="1 day" placeholder="e.g., 1 day, 2 days, 1 week">
                                    <div class="help-text">Duration of the analysis window (e.g., 1 day, 2 days, 1 week)</div>
                                </div>
                                <div class="form-group">
                                    <label>Window Period</label>
                                    <input type="text" id="windowPeriod" value="12 hours" placeholder="e.g., 12 hours, 6 hours, 1 day">
                                    <div class="help-text">Period between window evaluations (e.g., 12 hours, 6 hours, 1 day)</div>
                                </div>
                            </div>
                        </div>



                        <div class="expression-title">Common Expressions - Click to copy to clipboard:</div>
                        <div class="variable-chips">
                            <div class="chip-section">Entity Expressions for Scope</div>
                            <span class="chip" data-copy="EntityId('type: User && direction: Source')">EntityId('type: User && direction: Source')</span>
                            <span class="chip" data-copy="EntityId('type: Device && direction: Source')">EntityId('type: Device && direction: Source')</span>
                            <span class="chip" data-copy="EntityId('type: Device && direction: Dest')">EntityId('type: Device && direction: Dest')</span>
                            <span class="chip" data-copy="EntityAttribute('type: User && direction: Source', 'department')">EntityAttribute('type: User && direction: Source', 'department')</span>
                            <span class="chip" data-copy="'org'">'org'</span>
                            
                            <div class="chip-section">Common Feature Fields</div>
                            <span class="chip" data-copy="dest_ip">dest_ip</span>
                            <span class="chip" data-copy="src_ip">src_ip</span>
                            <span class="chip" data-copy="platform">platform</span>
                            <span class="chip" data-copy="dest_zone">dest_zone</span>
                            <span class="chip" data-copy="email_domain">email_domain</span>
                            <span class="chip" data-copy="app_name">app_name</span>
                            <span class="chip" data-copy="country">country</span>
                            <span class="chip" data-copy="user_agent">user_agent</span>
                            <span class="chip" data-copy="file_extension">file_extension</span>
                            <span class="chip" data-copy="process_name">process_name</span>
                        </div>
                    </div>

                    <div id="factFeatureFields" style="display:none;">
                        <!-- Detection Value is hidden and will be set to true by default -->
                        <input type="hidden" id="factValue" value="true">
                        <div class="form-group">
                            <div class="help-text">Fact-based detection will use "true" as the detection value</div>
                        </div>
                    </div>

                    <div id="contextFeatureFields" style="display:none;">
                        <div class="form-group">
                            <label>Context Value <span class="required">*</span></label>
                            <input type="text" id="contextValue" placeholder="e.g., GetContextAttribute('AD Table', user, 'department')">
                            <div class="help-text">The context data to identify</div>
                        </div>
                        
                        <div class="expression-title">Context Expressions - Click to copy to clipboard:</div>
                        <div class="variable-chips">
                            <span class="chip" data-copy="GetContextAttribute('AD Table', user, 'department')">GetContextAttribute('AD Table', user, 'department')</span>
                            <span class="chip" data-copy="GetContextAttribute('AD Table', user, 'email')">GetContextAttribute('AD Table', user, 'email')</span>
                            <span class="chip" data-copy="GetContextAttribute('AD Table', user, 'manager')">GetContextAttribute('AD Table', user, 'manager')</span>
                            <span class="chip" data-copy="ContextListContains('VIP_Users', user)">ContextListContains('VIP_Users', user)</span>
                            <span class="chip" data-copy="ContextListContains('Privileged_Accounts', user)">ContextListContains('Privileged_Accounts', user)</span>
                            <span class="chip" data-copy="HasContextKey('Executive_Team', user)">HasContextKey('Executive_Team', user)</span>
                        </div>
                    </div>

                    <div class="section-header">Required Fields</div>
                    <div class="required-fields-section">
                        <div class="help-text">Select fields that must be present in events for this rule to evaluate them:</div>
                        <div class="required-fields-list">
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_user" value="user">
                                <label for="rf_user">user</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_src_ip" value="src_ip">
                                <label for="rf_src_ip">src_ip</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_dest_ip" value="dest_ip">
                                <label for="rf_dest_ip">dest_ip</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_file_name" value="file_name">
                                <label for="rf_file_name">file_name</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_process_name" value="process_name">
                                <label for="rf_process_name">process_name</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_platform" value="platform">
                                <label for="rf_platform">platform</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_app_name" value="app_name">
                                <label for="rf_app_name">app_name</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_bucket_name" value="bucket_name">
                                <label for="rf_bucket_name">bucket_name</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_country" value="country">
                                <label for="rf_country">country</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_dest_zone" value="dest_zone">
                                <label for="rf_dest_zone">dest_zone</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_email_domain" value="email_domain">
                                <label for="rf_email_domain">email_domain</label>
                            </div>
                            <div class="field-checkbox">
                                <input type="checkbox" id="rf_login_type" value="login_type">
                                <label for="rf_login_type">login_type</label>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Additional Required Fields (comma-separated)</label>
                            <input type="text" id="additionalRequiredFields" placeholder="e.g., custom_field1, custom_field2">
                            <div class="help-text">Add any other fields that must be present</div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Event Filtering & Conditions -->
                <div class="step" id="step4">
                    <h2 class="step-title">Event Filtering & Conditions</h2>
                    <p class="step-description">Define event filtering criteria and conditions for your rule.</p>
                    
                    <div class="section-header">Event Filtering Criteria (Applicable Events) <span class="required">*</span></div>
                    <div class="help-text" style="margin-bottom: 15px; color: #666;">At least one event filtering field must be filled to define which events this rule applies to.</div>
                    <div class="event-filtering-section">
                        <div class="three-column-layout">
                            <div class="form-group">
                                <label>Event Type</label>
                                <input type="text" id="eventType" placeholder="Optional">
                            </div>

                            <div class="form-group">
                                <label>Activity Type <span class="required">*</span></label>
                                <select id="activityType" required>
                                    <option value="">Select activity type...</option>
                                    <option value="authentication">Authentication</option>
                                    <option value="app-login">Application Login</option>
                                    <option value="endpoint-login">Endpoint Login</option>
                                    <option value="file-download">File Download</option>
                                    <option value="file-upload">File Upload</option>
                                    <option value="file-read">File Read</option>
                                    <option value="file-write">File Write</option>
                                    <option value="email-send">Email Send</option>
                                    <option value="email-receive">Email Receive</option>
                                    <option value="process-create">Process Create</option>
                                    <option value="service-create">Service Create</option>
                                    <option value="user-create">User Create</option>
                                    <option value="web-request">Web Request</option>
                                    <option value="database-query">Database Query</option>
                                    <option value="vpn-login">VPN Login</option>
                                    <option value="dns-request">DNS Request</option>
                                    <option value="bucket-accessblock-modify">Bucket Access Block Modify</option>
                                    <option value="directory-service">Directory Service</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Activity</label>
                                <input type="text" id="activity" placeholder="Optional">
                            </div>
                        </div>

                        <div class="three-column-layout">
                            <div class="form-group">
                                <label>Subject</label>
                                <select id="subject">
                                    <option value="">Any subject...</option>
                                    <option value="user">User</option>
                                    <option value="device">Device</option>
                                    <option value="application">Application</option>
                                    <option value="process">Process</option>
                                    <option value="service">Service</option>
                                    <option value="file">File</option>
                                    <option value="network">Network</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Outcome</label>
                                <select id="outcome">
                                    <option value="">Any outcome...</option>
                                    <option value="success">Success</option>
                                    <option value="failure">Failure</option>
                                    <option value="unknown">Unknown</option>
                                    <option value="partial">Partial</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Product</label>
                                <input type="text" id="product" placeholder="Optional">
                            </div>
                        </div>

                        <div class="three-column-layout">
                            <div class="form-group">
                                <label>Product Category</label>
                                <input type="text" id="productCategory" placeholder="Optional">
                            </div>

                            <div class="form-group">
                                <label>Vendor</label>
                                <input type="text" id="vendor" placeholder="Optional">
                            </div>

                            <div class="form-group">
                                <label>Landscape</label>
                                <select id="landscape">
                                    <option value="">Any landscape...</option>
                                    <option value="endpoint">Endpoint</option>
                                    <option value="network">Network</option>
                                    <option value="cloud">Cloud</option>
                                    <option value="application">Application</option>
                                    <option value="identity">Identity</option>
                                    <option value="data">Data</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Platform</label>
                            <select id="platform">
                                <option value="">Any platform...</option>
                                <option value="Windows">Windows</option>
                                <option value="Linux">Linux</option>
                                <option value="macOS">macOS</option>
                                <option value="AWS">AWS</option>
                                <option value="Azure">Azure</option>
                                <option value="GCP">Google Cloud</option>
                                <option value="Office365">Office 365</option>
                                <option value="Salesforce">Salesforce</option>
                                <option value="ServiceNow">ServiceNow</option>
                            </select>
                        </div>
                    </div>

                    <div class="section-header">Rule Conditions</div>
                    <div class="form-group">
                        <label>Train On Condition</label>
                        <input type="text" id="trainOnCondition" placeholder="Default: true (train on all events)">
                        <div class="help-text">Expression defining which events to train on. Leave empty for "true".</div>
                    </div>

                    <div class="form-group">
                        <label>Act On Condition</label>
                        <input type="text" id="actOnCondition" placeholder="Default: true (trigger on all matching events)">
                        <div class="help-text">Expression defining which events can trigger the rule.</div>
                    </div>

                    <div class="common-expressions-section">
                        <div class="example-box">
                            <strong>Common Condition Examples:</strong>
                            <div style="margin-top: 10px;">
                                <div><code>true</code> - Apply to all events</div>
                                <div><code>platform = 'Windows'</code> - Only Windows events</div>
                                <div><code>outcome = 'success'</code> - Only successful events</div>
                                <div><code>outcome = 'failure'</code> - Only failed events</div>
                                <div><code>!inList(user, 'admin', 'system')</code> - Exclude admin/system users</div>
                                <div><code>!inList(landscape, 'endpoint', 'network')</code> - Exclude endpoint/network</div>
                                <div><code>platform = 'Windows' && inList(login_type, '2', '10', '11')</code> - Specific Windows logins</div>
                                <div><code>activity_type = 'file-read' && toLower(file_name)='lsass.exe'</code> - LSASS access</div>
                                <div><code>containsAny(toLower(operation), 'putbucketpublicaccessblock')</code> - Bucket operations</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Advanced Settings -->
                <div class="step" id="step5">
                    <h2 class="step-title">Advanced Settings</h2>
                    <p class="step-description">Fine-tune your rule's behavior and classification.</p>
                    

                    <div class="form-group" id="anomalyThresholdGroup" style="display:none;">
                        <label>Anomaly Threshold</label>
                        <select id="anomalyThreshold" onchange="toggleCustomThreshold()">
                            <option value="30 days">30 days</option>
                            <option value="60 days">60 days</option>
                            <option value="90 days" selected>90 days (Recommended)</option>
                            <option value="120 days">120 days</option>
                            <option value="180 days">180 days</option>
                            <option value="365 days">365 days</option>
                            <option value="custom">Custom...</option>
                        </select>
                        <div id="customThresholdInput" style="display:none; margin-top:10px;">
                            <input type="number" id="customThresholdValue" min="1" max="365" placeholder="Enter days (1-365)">
                            <div class="help-text">Enter a value between 1 and 365 days</div>
                        </div>
                        <div class="help-text">Duration threshold for re-triggering the rule when the learned baseline pattern hasn't been observed</div>
                    </div>

                    <div id="maturitySettings" style="display:none;">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="checkScopeMaturity"> Enable Scope Maturity Check
                            </label>
                            <div class="help-text">Wait for baseline before triggering on scope entities</div>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="checkFeatureMaturity"> Enable Feature Maturity Check
                            </label>
                            <div class="help-text">Wait for baseline before triggering on feature values</div>
                        </div>

                        <div class="form-group" id="maturityThresholdGroup" style="display:none;">
                            <label>Maturity Threshold</label>
                            <select id="maturityThreshold">
                                <option value="14 days" selected>14 days (Recommended)</option>
                                <option value="21 days">21 days</option>
                                <option value="28 days">28 days</option>
                            </select>
                        </div>
                    </div>

                    <div id="suppressionSettings" style="display:none;">
                        <div class="form-group">
                            <label>Suppress Threshold</label>
                            <select id="suppressThreshold">
                                <option value="1 minute">1 minute</option>
                                <option value="5 minutes">5 minutes</option>
                                <option value="10 minutes" selected>10 minutes</option>
                            </select>
                            <div class="help-text">Prevent rule from over-triggering within this window</div>
                        </div>
                        <div class="form-group">
                            <label>Suppress Scope</label>
                            <select id="suppressScope">
                                <option value="org">Organization</option>
                                <option value="user">User</option>
                                <option value="device">Device</option>
                                <option value="app">Application</option>
                            </select>
                            <div class="help-text">Scope for suppression (default: org)</div>
                        </div>
                    </div>

                    <div id="numericAdvancedSettings" style="display:none;">
                        <div class="section-header">Numeric Rule Settings</div>
                        <div class="two-column-layout">
                            <div class="form-group">
                                <label>Log Base</label>
                                <input type="number" id="logBase" value="2" min="1" max="10">
                                <div class="help-text">Logarithmic base for magnitude calculation (default: 2)</div>
                            </div>
                            <div class="form-group">
                                <label>Min Order of Magnitude</label>
                                <input type="number" id="minOrderOfMagnitude" value="1.0" min="0.1" max="10" step="0.1">
                                <div class="help-text">Minimum order of magnitude threshold (default: 1.0)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Review and Generate -->
                <div class="step" id="step6">
                    <h2 class="step-title">Review and Generate</h2>
                    <p class="step-description">Review your configuration and generate the JSON rule file.</p>
                    
                    <div class="example-box">
                        <strong>Rule Summary:</strong>
                        <div id="ruleSummary"></div>
                    </div>

                    <div class="form-group">
                        <label>Generated JSON:</label>
                        <div class="json-output" id="jsonOutput"></div>
                        <button class="copy-button" onclick="copyJSON()">📋 Copy JSON</button>
                        <button class="copy-button" onclick="downloadJSON()" style="background: #0284c7; margin-left: 10px;">💾 Download JSON</button>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-prev" onclick="previousStep()" id="prevBtn" style="visibility: hidden;">Previous</button>
                <button class="btn-next" onclick="nextStep()" id="nextBtn">Next</button>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast">Copied to clipboard!</div>

    <!-- Embedded CSVs for offline use (no web server required) -->
    <script id="families_csv" type="text/plain">Family Name,Family ID,Description,Example Analytics Rules
        Application Authentication Activity,app-auth-activity,"Evaluates all events where authentication to an application has failed","Abnormal number of failed authentications to one or more applications for this user"
        Application Login Activity,app-login-activity,"Evaluates all application logins","Abnormal number of failed logins to one or more applications for this user; First application login event from this endpoint for the organization"
        Audit Policy Modification Activity,audit-policy-mod,"Evaluates all events where audit policies are modified","Endpoint is critical: True\False; First audit policy modification for this user"
        Authentication Activity,auth-activity,"Evaluates all events involving authentication","Abnormal number of MFA authentication events for this user; Abnormal number of unique services used to obtain Kerberos tickets for this user"
        Bucket Creation Activity,bucket-creation-activity,"Evaluates all events where cloud buckets are created","First bucket creation for this user"
        Bucket Permission Modification Activity,bucket-permission-modification-activity,"Evaluates all events where bucket permissions, policies, or access control lists (ACLs) are modified","Bucket policy/ACL was modified to make it public; First AWS bucket ACL modification for this user"
        Cloud Policy Management Activity,cloud-policy-management-activity,"Evaluates all events where cloud policies are created, modified, or attached","A cloud resource policy in GCP was modified with administrative permissions; A cloud resource policy in GCP was modified with public permissions; An administrative policy was created or attached to an identity in AWS"
        Compute Disk Activity,compute-disk-activity,"Evaluates all events involving compute disk and volume","Abnormal number of unique volumes attached for this user; First volume attachment for this user; First volume creation from a snapshot for this user"
        Compute Image Activity,compute-image-activity,"Evaluates all events involving compute images","An image resource has been made public in AWS; First image creation for this user; First image creation with this publisher for the organization"
        Compute Snapshot Activity,compute-snapshot-activity,"Evaluates all events involving compute snapshots","A snapshot resource has been made public in AWS; First snapshot creation for this user; First snapshot user permissions modification for this user"
        Compute Virtual Machine Activity,compute-vm-activity,"Evaluates all events where compute instances are managed","A startup script was added to an instance in AWS; A startup/shutdown script was added to an instance in GCP; First instance SSH key modification for this user in GCP"
        Database Activity,database-activity,"Evaluates all events where database is the subject","Abnormal number of database operation events observed for this user; First database event in this database for this user; First database event in this database for users in this department"
        Database Query Activity,database-query-activity,"Evaluates all events where databases are queried","Abnormal database query response size for this user; Abnormal database query response size in this database for this source network zone; Abnormal database query response size in this database for this user"
        Directory Service Activity,directory-service-activity,"Evaluates all events that originated from a directory service or that are targeting directory service objects","First directory service activity for this directory service object class; First directory service activity from this endpoint for the organization; First directory service activity from this endpoint for this user"
        Directory Service Object Write Activity,directory-service-object-write-activity,"Evaluates all events where directory service objects are created or modified","Abnormal number of directory service write events for the organization; Abnormal number of directory service write events for users in this department; DCShadow related SPNs have been added to an endpoint"
        DLL Load Activity,dll-load-activity,"Evaluates all events where DLL image are loaded","First DLL image loaded from this folder for the organization; First DLL image with this extension loaded for the organization; First DLL image with this extension loaded for this process"
        DNS Activity,dns-activity,"Evaluates all events involving DNS protocols","A DNS query was sent to a domain associated with the SUNBURST malware"
        DNS Request Activity,dns-request-activity,"Evaluates all events involving DNS requests","Abnormal amount of bytes sent in DNS queries for the organization; Abnormal amount of bytes sent in DNS queries from this endpoint; Abnormal amount of bytes sent in DNS queries from this network zone"
        DNS Response Activity,dns-response-activity,"Evaluates all events involving DNS responses","Abnormal number of DNS queries to NX domains for the organization; Abnormal number of DNS queries to NX domains from this endpoint"
        Email Receive Activity,email-receive-activity,"Evaluates events involving incoming email","Abnormal amount of bytes received in incoming emails for this user; Abnormal number of emails received for this user; First email attachment with this extension received for the organization"
        Email Rule Creation Activity,email-rule-create-activity,"Evaluates all events where email rules are created","An inbox rule has been configured to forward emails to an external email address"
        Email Send Activity,email-send-activity,"Evaluates all events involving outgoing emails","Abnormal amount of bytes sent in outgoing emails for this user; Abnormal number of emails sent for this user; An email containing a source code file was sent"
        Endpoint Login Activity,endpoint-login-activity,"Evaluates all events involving endpoint logins","A service account failed an interactive login to an endpoint; Abnormal number of failed endpoint logins from this endpoint for this user; Destination endpoint is a Domain Controller: True\False"
        Endpoint Login Activity - NAC,endpoint-login-activity-nac,"Evaluates all events where endpoint logins originate from a network access application","First network access control login event from this MAC address for this user"
        Endpoint Screenshot Activity,endpoint-screenshot-activity,"Evaluates all events involving endpoint screenshots","Abnormal number of screenshot events for this user"
        File Activity,file-activity,"Evaluates all file events","First source code file activity for this user; First source code file activity for users in this department"
        File Delete Activity,file-delete-activity,"Evaluates all events where files are deleted","Abnormal number of file deletion events for this user; Abnormal number of unique remote destination endpoints in file deletion events for this user"
        File Download Activity,file-download-activity,"Evaluates all events where files are downloaded","Abnormal amount of file download events for the organization; An executable file was downloaded; First file download to this endpoint for the organization"
        File Permission Modification Activity,file-permission-modify-activity,"Evaluates all events where file permissions are modified","First cloud storage object file modification to public for this bucket; First cloud storage object file modification to public for this user"
        File Read Activity,file-read-activity,"Evaluates all events where files are read","A 'PST'\\'OST' file was copied; Abnormal amount of file bytes read in this bucket for this user; Abnormal number of unique endpoints in file read events for this user"
        File Upload Activity,file-upload-activity,"Evaluates all events where files are uploaded","Abnormal amount of file upload events for the organization; Abnormal amount of file upload events for this user; First file upload from this endpoint for the organization"
        File Write Activity,file-write-activity,"Evaluates all file write events","A file with an '.exe' extension following a non-executable extension was written to; Abnormal number of unique files written for this user; The 'ds7002.lnk' file was written to"
        File Write Activity – USB,file-write-activity-usb,"Evaluates all events where files are written to a USB device","Abnormal amount of file bytes written to peripheral storage devices for this user; Abnormal number of unique files written to peripheral storage devices by this user; File has a .pst/.ost extension: True\False"
        General Activity,general-activity,"Evaluates ALL events","A TOR IP address was accessed; Abnormal number of unique failed operations in this platform for this user; First activity from this country for the organization"
        Group Member Addition Activity,group-member-addition-activity,"Evaluates all events where members are added to groups","First group member addition for this system account on this endpoint; Security group is privileged: True\False; User added themselves to a security group: True\False"
        Log Clear Activity,log-clear-activity,"Evaluates all log clear events","An audit log was cleared; Endpoint is critical: True\False; First audit log clear for this user"
        Login Activity,login-activity,"Evaluates all login events","A hacking tool domain was used in a login; Abnormal number of unique destination network zones in login events for this user; First login from this network zone for this user; Login type"
        Mailbox Permission Modification Activity,mailbox-permission-modification-activity,"Evaluates events where mailbox permissions are modified","Abnormal number of mailbox permission modifications for this user; First mailbox permission modification for this user; The mailbox permissions of an executive user were changed by another user"
        Network Activity,network-activity,"Evaluates all network events","A BitTorrent port was accessed; Abnormal amount of bytes failed to be sent in outbound communication from this endpoint; Network activity failed: True\False"
        Password Checkout Activity,password-checkout-activity,"Evaluates all all vault password checkout events","Abnormal number of password retrievals for the organization; Abnormal number of unique safes in password retrieval events for this user"
        Physical Location Access Activity,physical-location-access-activity,"Evaluates all events involving access to physical locations","Abnormal number of unique cities physically accessed for this user; First physical access to this door for this user; Physical access failed: True\False"
        Privilege Use Activity,privilege-use-activity,"Evaluates all privilege use activity","Abnormal number of administrative privilege access events for this user; First Windows privilege use for this users in this department"
        Process Creation Activity,process-creation-activity,"Evalautes all events where processes are executed","'appcmd.exe' was used to disable IIS HTTP logging; 'certutil.exe' executed with suspicious parameters; 'dir.exe' was used to enumerate the users folder"
        Registry Activity,registry-activity,"Evaluates all registry events","The WDigest authentication protocol was enabled via the registry"
        Role Assumption Activity,role-assume-activity,"Evaluates all events where roles are assumed","Abnormal number of unique roles assumed for this user; First role assumption event for this user; First role assumption of this role for this user"
        Role Permission Modification,role-permission-modification-activity,"Evaluates all events where role permissions are modified","First role permission modification for this user on this platform; First role permission modification to public for this role"
        Role Creation and Modification Activity,role-write-activity,"Evaluates all events where roles are created or modified","First role creation or modification for this user on this platform"
        Rule Delete Activity,rule-delete-activity,"Evaluates all events where security rules are deleted","Abnormal number of security rules deletions for this user"
        Scheduled Tasks Creation Activity,scheduled-task-creation-activity,"Evaluates all events where scheduled tasks are created","A scheduled task was configured to execute PowerShell; First creation of a scheduled task with this name for the organization"
        Script Execution Activity – PowerShell,script-execution-activity,"Evaluates all events involving PowerShell scripts and invocations","Abnormal number of PowerShell command invocations for the organization; First PowerShell script execution for this user"
        Security Alerts,security-alerts,"Evaluates all events where alerts are triggered","A correlation rule was triggered; Abnormal number of unique alerts triggered for this user; Alert is from a third party: True\False; First network alert trigger on this port for this destination network zone"
        Security Alerts – DLP,security-alerts-dlp,"Evaluates all events involving DLP alerts","Abnormal number of unique protocols in DLP alerts for this user; First DLP alert trigger on this domain for this protocol"
        Share Access Activity,share-access-activity,"Evaluates all events where access is shared","Abnormal number of unique network shares accessed for this user; First access to this network share for this user; Share is a known named pipe: True\False"
        USB Activity,usb-activity,"Evaluates all events that occurred on or in peripheral devices","First peripheral device activity for this user; First peripheral device activity from this endpoint for users in this department"
        User Activity,user-activity,"Evaluates all user events","A non-privileged user accessed an attribute of a privileged directory service user account"
        User Creation Activity,user-creation-activity,"Evaluates all events where users are created","First user creation for this system account on this endpoint; User is local: True\False"
        User Deletion Activity,user-deletion-activity,"Evaluates all events where users are deleted","First user deletion for this user"
        User Key Creation Activity,user-key-creation-activity,"Evaluates all events where user associated keys are created","First account key creation for this user"
        User Lock Activity,user-lock-activity,"Evaluates all user lockdown events","First user lock for this user"
        User Password Modification Activity,user-password-modification-activity,"Evaluates all events where user account passwords are modified","Abnormal amount of password resets for user; First user account password modification for this user"
        User Switch Activity,user-switch-activity,"Evaluates all events where a user switches identities","Dest user is privileged: True\False; First account switch for this user"
        VPN Login Activity,vpn-login-activity,"Evaluates all events involving VPN logins","Abnormal number of failed vpn logins for this user; First VPN login for this user; User is a contractor : True\False"
        VPN Logout Activity,vpn-logout-activity,"Evaluates all events involving VPN logouts","Abnormal amount of bytes uploaded in VPN sessions for this user; Abnormal VPN session duration for this user"
        Web Activity,web-activity,"Evaluates all events involving web protocols","Abnormal amount of bytes downloaded from file sharing websites for this user; First HTTP communication from this endpoint for the organization; Endpoint is a Domain Controller: True\False"
        Web Meeting Activity,web-meeting-activity,"Evaluates all events where a web meeting is the subject","A meeting was modified to remove the meeting password"
        Web Request Activity,web-request-activity,"Evaluates all events involving HTTP requests","Abnormal number of failed HTTP requests for this user"
        Windows Service Creation Activity,windows-service-creation-activity,"Evaluates all events where a Windows system service is created","A service was created from a temporary internet files directory; First process path for this service"</script>

    <script id="groups_csv" type="text/plain">Family Name,Group Name,Group ID,Analytics Rules
        Application Authentication,First event count magnitude,appaf-event-count-magnitude-group,"Abnormal number of failed authentications to one or more applications for this user"
        Application Login,First event count magnitude,app-event-count-magnitude-group,"Abnormal number of failed logins to one or more applications for this user"
        Application Login,First source ISP for application login,al-source-isp-group,"First application login event from this ISP for the organization; First application login event from this ISP for this user; First application login event from this ISP for users in this department; First application login event from this ISP for users with this manager"
        Application Login,First time of the day for app login,al-time-of-day-group,"First timeframe of an application login for this user"
        Application Login,User criticality context,app-critical-user-group,"User is a service account"
        Application Login,First source host for application login,al-source-endpoint-access-group,"First application login event from this endpoint for the organization; First application login event from this endpoint for this user"
        Application Login,First MFA status,al-mfa-status-group,"First application login event without multi factor authentication for this user"
        Application Login,First source country code for application login,al-source-country-group,"First application login event from this country for the organization; First application login event from this country for this user; First application login event from this country for users in this department; First application login event from this country for users with this manager"
        Audit Policy Modification,First source endpoint access,audit-source-endpoint-access-group,"First audit policy modification from this endpoint"
        Audit Policy Modification,First user,audit-first-user-activity-group,"First audit policy modification for this user"
        Audit Policy Modification,Asset criticality context,audit-critical-endpoint-group,"Asset is a critical system"
        Authentication,First MFA event count magnitude,auth-mfa-count-magnitude-group,"Abnormal number of MFA authentication events for this user"
        Authentication,First distinct TGS service count magnitude,auth-tgs-count-magnitude-group,"Abnormal number of unique services used to obtain Kerberos tickets for this user"
        Bucket Creation,First user,bc-first-user-activity-group,"First bucket creation for this user"
        Bucket Permission Modification,Public bucket,bpm-public-group,"Bucket policy/ACL was modified to make it public; Public access block was removed from an AWS bucket; First AWS bucket policy/ACL modification to public for this user"
        Bucket Permission Modification,First user,bpm-first-user-activity-group,"First AWS bucket ACL modification for this user; First AWS bucket policy modification for this user"
        Cloud Policy Management,First dest user type,cpm-dest-user-type-group,"First GCP IAM permissions granted to a user with this user type"
        Cloud Policy Management,First user,cpm-first-user-activity-group,"First policy attachment to an identity in AWS for this user; First IAM policy creation or modification for this user on this platform; First AWS policy version rollback for this user"
        Cloud Policy Management,First resource,cpm-first-resource-group,"First GCP resource in an IAM policy modification for the organization; First GCP resource in an IAM policy modification for this user"
        Cloud Policy Management,Policy criticality,cpm-critical-policy-group,"An administrative policy was created or attached to an identity in AWS; A cloud resource policy in GCP was modified with administrative permissions; A cloud resource policy in GCP was modified with public permissions"
        Cloud Policy Management,First dest domain,cpm-dest-domain-group,"First GCP IAM permissions granted to a user from this domain"
        Compute Disk,First event count magnitude,cda-event-count-magnitude-group,"Abnormal number of unique volumes attached for this user"
        Compute Disk,First user,cda-first-user-activity-group,"First volume attachment for this user; First volume creation from a snapshot for this user"
        Compute Image,Public image,cia-public-group,"An image resource has been made public in AWS"
        Compute Image,First user,cia-first-user-activity-group,"First image user permissions modification for this user; First image creation for this user"
        Compute Image,First publisher,cia-publisher-group,"First image creation with this publisher for the organization"
        Compute Snapshot,Public snapshot,csa-public-group,"A snapshot resource has been made public in AWS"
        Compute Snapshot,First user,csa-first-user-activity-group,"First snapshot user permissions modification for this user; First snapshot creation for this user"
        Compute Virtual Machine,First remote command,cvma-remote-command-group,"First remote command execution on an instance for this user"
        Compute Virtual Machine,First instance key,cvma-key-group,"First instance SSH key modification for this user in GCP"
        Compute Virtual Machine,Instance startup,cvma-startup-group,"A startup script was added to an instance in AWS; A startup/shutdown script was added to an instance in GCP"
        Database,First source endpoint access,db-source-endpoint-access-group,"First database event in this database from this endpoint for this user; First database event in this database from this IP address for this user; First database event in this database from this network zone for this user"
        Database,First database operation,database-operation-group,"First database operation from this network zone; First database operation on this database for this user; First database operation on this database for users in this department; First database operation on this database for users with this manager"
        Database,First database operation count magnitude,dbop-count-magnitude-group,"Abnormal number of database operation events observed for this user; Abnormal number of unique database operations observed for this user"
        Database,First user,db-first-user-activity-group,"First database event in this database for this user; First database event in this database for users in this department; First database event in this database for users with this manager"
        Database Query,First response size magnitude,dbq-response-magnitude-group,"Abnormal database query response size for this user; Abnormal database query response size in this database for this source network zone; Abnormal database query response size in this database for this user"
        Database Query,First query length magnitude,dbq-length-magnitude-group,"Abnormal database query size for this user"
        Directory Service,First activity type,dsf-first-activity-type-group,"First failed directory service activity type for this user; First failed directory service activity type for users in this department; First failed directory service activity type for users with this manager"
        Directory Service,First object class,ds-object-class-group,"First directory service object class for the organization; First directory service object class for this user; First directory service object class for users in this department; First directory service object class for users with this manager"
        Directory Service,First user,ds-first-user-activity-group,"First directory service activity for this user; First directory service activity for users in this department; First directory service activity for users with this manager"
        Directory Service,First event count magnitude,ds-event-count-magnitude-group,"Abnormal number of directory service events for the organization; Abnormal number of directory service events for this user; Abnormal number of directory service events for users in this department; Abnormal number of directory service events for users with this manager"
        Directory Service,First failed event count magnitude,dsf-event-count-magnitude-group,"Abnormal number of failed directory service events for the organization; Abnormal number of failed directory service events for this user; Abnormal number of failed directory service object events for users in this department; Abnormal number of failed directory service object events for users with this manager"
        Directory Service,First source endpoint access,ds-source-endpoint-access-group,"First directory service activity from this endpoint for the organization; First directory service activity from this network zone for the organization; First directory service activity from this endpoint for this user; First directory service activity from this network zone for this user; First directory service activity from this endpoint for users in this country; First directory service activity from this network zone for users in this country; First directory service activity from this endpoint for users in this department; First directory service activity from this network zone for users in this department; First directory service activity from this endpoint for users with this manager; First directory service activity from this network zone for users with this manager"
        Directory Service,First activity type,ds-first-activity-type-group,"First directory service activity for this directory service object class; First directory service activity type from this endpoint; First directory service activity type for this user"
        Directory Service,First attribute,ds-attribute-group,"First directory service object attribute accessed for this privileged user"
        Directory Service Object Write,DCSync attack,dcsync-attack-group,"DCShadow related SPNs have been added to an endpoint"
        DLL Load,Abnormal extension,dll-abnormal-extension-group,"First DLL image with this extension loaded for the organization; First DLL image with this extension loaded for this process; First DLL image with this extension loaded on this endpoint"
        DLL Load,Executable image load,dll-image-load-group,"MI provider service used to invoke CMD/PowerShell"
        DLL Load,Abnormal directory,dll-abnormal-directory-group,"First DLL image loaded from this folder for the organization"
        DLL Load,First DLL name,dllname-group,"First DLL image with this name loaded for the organization"
        DNS,Suspicious domain query,dns-susp-domain-query-group,"A DNS query was sent to a domain associated with the SUNBURST malware"
        DNS Request,First query count magnitude,dns-query-count-magnitude-group,"Abnormal number of unique DNS queries from this endpoint"
        DNS Request,First bytes sum magnitude,dns-bytes-sum-magnitude-group,"Abnormal amount of bytes sent in DNS queries for the organization; Abnormal amount of bytes sent in DNS queries from this endpoint; Abnormal amount of bytes sent in DNS queries from this network zone"
        DNS Response,First NX response count magnitude,dns-nxresp-count-magnitude-group,"Abnormal number of DNS queries to NX domains for the organization; Abnormal number of DNS queries to NX domains from this endpoint"
        Email Receive,First event count magnitude,emailr-event-count-magnitude-group,"Abnormal number of emails received for this user"
        Email Receive,First email receive from domain,emails-received-domain-group,"First email received from this email domain for the organization; First email received from this email domain for this user; First email received from this email domain for users in this department; First email received from this email domain for users with this manager"
        Email Receive,First file extension received via email,emails-received-file-extension-group,"First email attachment with this extension received for the organization; First email attachment with this extension received for this user; First email attachment with this extension received for users in this department; First email attachment with this extension received for users with this manager"
        Email Receive,First bytes sum magnitude,emailr-bytes-sum-magnitude-group,"Abnormal amount of bytes received in incoming emails for this user"
        Email Rule Creation,Suspicious forward rule,emailrc-susp-forward-rule-group,"An inbox rule has been configured to forward emails to an external email address"
        Email Send,Outcome context,emails-outcome-group,"Email sent outcome"
        Email Send,Job search email,emails-jobsearch-group,"An email containing a resume was sent"
        Email Send,First file extension,emails-file-extension-group,"First email attachment with this extension sent for the organization; First email attachment with this extension sent for this user; First email attachment with this extension sent for users in this department; First email attachment with this extension sent for users with this manager"
        Email Send,First event count magnitude,emails-event-count-magnitude-group,"Abnormal number of emails sent for this user"
        Email Send,First destination country code,emails-destination-country-group,"First email sent to this country for the organization; First email sent to this country for this user; First email sent to this country for users in this country; First email sent to this country for users in this department; First email sent to this country for users with this manager"
        Email Send,Competition email,emails-competition-group,"An email was sent to a competitor email domain"
        Email Send,First attachment count magnitude,emails-attachment-count-magnitude-group,"Abnormal number of email attachments in a sent email for this user"
        Email Send,Source code email,emails-source-code-group,"An email containing a source code file was sent"
        Email Send,First bytes sum magnitude,emails-bytes-sum-magnitude-group,"Abnormal amount of bytes sent in outgoing emails for this user"
        Endpoint Login,Service account,el-service-account-group,"A service account failed an interactive login to an endpoint"
        Endpoint Login,First dest endpoint access,el-destination-endpoint-access-group,"First login to this endpoint for this user; First login to this endpoint for users in this country; First login to this endpoint for users in this department; First login to this endpoint for users with this manager; First failed login to this endpoint for this user"
        Endpoint Login,First unique user count magnitude,el-user-count-magnitude-group,"Abnormal number of unique users failed to log into this endpoint; Abnormal number of unique users failed to login from this endpoint"
        Endpoint Login,Asset criticality context,el-critical-endpoint-group,"Destination endpoint is critical; Destination endpoint is a domain controller; Destination endpoint is a workstation"
        Endpoint Login,Failed login context,el-failed-login-group,"The user failed to login due to bad credentials"
        Endpoint Login,First account,el-first-account-group,"First endpoint login using this domain account for this user"
        Endpoint Login,First source endpoint access,el-source-endpoint-access-group,"First endpoint login event from this endpoint for this user; First endpoint login event to a domain controller from this network zone for the organization; First successful NTLM login from this endpoint"
        Endpoint Login,First unique dest host count magnitude,el-dest-host-count-magnitude-group,"Abnormal number of unique destination endpoints observed in endpoint login events for the organization; Abnormal number of unique destination endpoints observed in endpoint login events for this user; Abnormal number of unique destination endpoints observed in endpoint login events for users in this country; Abnormal number of unique destination endpoints observed in endpoint login events for users in this department; Abnormal number of unique destination endpoints observed in endpoint login events users with this manager"
        Endpoint Login,Disabled user,el-disabled-user-group,"A disabled user attempted to log into an endpoint"
        Endpoint Login,First event count magnitude,el-event-count-magnitude-group,"Abnormal number of failed endpoint logins to this endpoint for this user; Abnormal number of failed endpoint logins to this network zone for this user; Abnormal number of failed RDP endpoint logins to this endpoint for this user; Abnormal number of failed endpoint logins from this endpoint for this user"
        Endpoint Login,First unique source host count magnitude,el-src-host-count-magnitude-group,"Abnormal number of unique endpoints failed to log into this endpoint"
        Endpoint Login,First time of the day,el-time-of-day-group,"First timeframe of an endpoint login for this user; First timeframe of a failed endpoint login for this user"
        Endpoint Login,First host type,el-host-type-group,"First endpoint login to an endpoint of this type for this user"
        Endpoint Login,User criticality context,el-critical-user-group,"Domain account is privileged; User is executive; User is a service account; User is privileged"
        Endpoint Login - NAC,First login type,enac-login-type-group,"First network access control login type for the organization; First network access control login type for this user; First network access control login type for users in this department; First network access control login type for users with this manager"
        Endpoint Login - NAC,First location,enac-first-location-group,"First network access control login from this network location for this user"
        Endpoint Login - NAC,First source endpoint access,enac-source-endpoint-access-group,"First network access control login event from this MAC address for this user"
        Endpoint Screenshot,First event count magnitude,escrn-event-count-magnitude-group,"Abnormal number of screenshot events for this user"
        Endpoint Screenshot,First user,escrn-first-user-activity-group,"First screenshot event for this user"
        File,First source code file activity,file-source-code-group,"First source code file activity for this user; First source code file activity for users in this department; First source code file activity for users with this manager"
        File,First time of the day,file-time-of-day-group,"First timeframe of a file activity for this user"
        File,First source endpoint access,file-source-endpoint-access-group,"First file activity from this network zone for the organization; First file activity from this endpoint for this user; First file activity from this network zone for this user"
        File,First dest endpoint access,file-destination-endpoint-access-group,"First file activity on this endpoint for this user; First file activity on this endpoint for users in this country; First file activity on this endpoint for users in this department; First file activity on this endpoint for users with this manager"
        File Delete,First unique dest host count magnitude,filed-dest-host-count-magnitude-group,"Abnormal number of unique source endpoints in file deletion events on this endpoint for this user"
        File Delete,First event count magnitude,filed-event-count-magnitude-group,"Abnormal number of file deletion events for this user"
        File Download,First source host for file download,filedld-source-endpoint-access-group,"First file download to this endpoint for the organization; First file download to this endpoint for this user"
        File Download,First source ISP for file download,filedld-source-isp-group,"First file download to this ISP for the organization; First file download to this ISP for this user; First file download to this ISP for users in this department; First file download to this ISP for users with this manager"
        File Download,Download executable file,filedld-executable-file-group,"An executable file was downloaded"
        File Download,First source country code for download file,filedld-source-country-group,"First file download to this country for the organization; First file download to this country for this user; First file download to this country for users in this department; First file download to this country for users with this manager"
        File Download,First event count magnitude,filedld-event-count-magnitude-group,"Abnormal amount of file download events for the organization; Abnormal amount of file download events for this user; Abnormal amount of file download events for users in department; Abnormal amount of file download events for users with this manager"
        File Permission Modification,Public file,filepm-public-group,"First cloud storage object file modification to public for this bucket; First cloud storage object file modification to public for this user"
        File Read,Outlook file copy,filec-outlook-group,"An Outlook file was copied to another folder; A 'PST'/'OST' file was copied"
        File Read,First unique dest host count magnitude,filer-dest-host-count-magnitude-group,"Abnormal number of unique endpoints in file read events for this user"
        File Read,First event count magnitude,filer-event-count-magnitude-group,"Abnormal number of unique files read in this bucket for this user; Abnormal number of unique files read in this storage account for this user; Abnormal number of unique files read for this user; Abnormal number of unique files read in this platform for this user"
        File Read,Asset criticality context,filer-critical-endpoint-group,"File was read from a repository"
        File Read,First file size magnitude,filer-size-magnitude-group,"Abnormal amount of file bytes read in this bucket for this user; Abnormal amount of file bytes read in this storage account for this user; Abnormal amount of file bytes read in this platform for this user"
        File Read,Lssas memory access,filer-lssas-memory-group,"A process has directly accessed 'lsass.exe' memory space"
        File Upload,First source ISP for file upload,fileupld-source-isp-group,"First file upload from this ISP for the organization; First file upload from this ISP for this user; First file upload from this ISP for users in this department; First file upload from this ISP for users with this manager"
        File Upload,First source country code for upload file,fileupld-source-country-group,"First file upload from this country for the organization; First file upload from this country for this user; First file upload from this country for users in this department; First file upload from this country for users with this manager"
        File Upload,First source host for file upload,fileupld-source-endpoint-access-group,"First file upload from this endpoint for the organization; First file upload from this endpoint for this user"
        File Upload,First event count magnitude,fileupld-event-count-magnitude-group,"Abnormal amount of file upload events for the organization; Abnormal amount of file upload events for this user; Abnormal amount of file upload events for users in this department; Abnormal amount of file upload events for users with this manager"
        File Write,IOC - Unidentified 2018 APT,filew-ioc-2018apt,"The 'ds7002.lnk' file was written to"
        File Write,First event count magnitude,filew-event-count-magnitude-group,"Abnormal number of unique files written for this user"
        File Write,Double extension,fw-double-extension-group,"A file with an '.exe' extension following a non-executable extension was written to"
        File Write,First file from process,filew-file-process-group,"First file with this name created by 'umworkerprocess.exe'"
        File Write - USB,First bytes sum magnitude,fwusb-bytes-sum-magnitude-group,"Abnormal amount of file bytes written to peripheral storage devices for this user"
        File Write - USB,Outlook file copy context,fwusb-outlook-group,"A file ending in .pst/.ost is written to USB"
        File Write - USB,First unique file path count magnitude,fwusb-path-count-magnitude-group,"Abnormal number of unique files written to peripheral storage devices by this user"
        General,Disabled user,ga-disabled-user-group,"Activity from a disabled user"
        General,First time of the day,ga-time-of-day-group,"First timeframe of any activity for this user"
        General,First mime,ga-first-mime-group,"First MIME type for the organization"
        General,User criticality context,ga-critical-user-group,"User is a service account"
        General,First os browser,ga-first-os-browser-group,"First OS and browser combination for this user; First OS and browser combination for this organization; First OS and browser combination for users in this department; First OS and browser combination for users with this manager"
        General,First platform,ga-first-platform-group,"First activity on this platform for this user; First activity on this platform for users in this department; First activity on this platform for users with this manager"
        General,First source endpoint access,ga-source-endpoint-access-group,"First activity from this network zone for this platform; First activity from this endpoint on this platform for this user"
        General,First operation,ga-first-operation-group,"First operation for this platform"
        General,First unique dest ip magnitude,ga-dest-ip-count-magnitude-group,"Abnormal number of unique destination IPs accessed from this endpoint"
        General,First ISP,ga-first-isp-group,"First activity from this ISP for the organization; First activity from this ISP for this user; First activity from this ISP for users in this department; First activity from this ISP for users with this manager"
        General,First unique operation count magnitude,go-operation-count-magnitude-group,"Abnormal number of unique failed operations in this platform for this user"
        General,First source country code,ga-source-country-group,"First activity from this country for the organization; First activity from this country for this user; First activity from this country for users in this country; First activity from this country for users in this department; First activity from this country for users with this manager; First activity from this country to this zone; First activity to this country from this zone"
        General,First destination country code,ga-destination-country-group,"First activity to this country for the organization"
        General,First cloud service,ga-cloudservice-group,"First cloud service in this platform for this user; First cloud service in this platform for users in this department; First cloud service in this platform for users with this manager"
        General,First asset feature,ga-asset-feature-group,"First activity from this endpoint to this endpoint"
        General,Threat indicators,ga-ti-group,"An attempt was made to connect to an IP address with a bad reputation from this endpoint; An attempt was made to connect from an IP address with a bad reputation from this endpoint"
        General,Threat indicators - TOR,ga-ti-tor-group,"A TOR IP address was accessed"
        General,First cloud region,ga-region-group,"First cloud region for the organization; First cloud region for this user"
        General,Failed activity context,ga-failed-activity-group,"Failed activity"
        General,First unique dest host count magnitude,ga-dest-host-count-magnitude-group,"Abnormal number of unique destination endpoints accessed from this endpoint"
        General,Threat indicators - Ransomware,ga-ti-ransomware-group,"An attempt was made to connect to an IP address associated to Ransomware from this endpoint; An attempt was made to connect to this endpoint from an IP address associated to Ransomware"
        General,First browser,ga-first-browser-group,"First web browser for this organization; First web browser for this user; First web browser for users in this department; First web browser for users with this manager"
        General,First OS,ga-first-os-group,"First operating system for this organization; First operating system for this user; First operating system for users in this department; First operating system for users with this manager"
        Group Member Addition,First user,gma-first-user-activity-group,"First group member addition for this user; First group member addition for users in this department; First group member addition for users with this manager; First group member addition for this system account on this endpoint"
        Group Member Addition,First dest endpoint access,gma-destination-endpoint-access-group,"First group member addition on this endpoint"
        Group Member Addition,First time of the day,gma-time-of-day-group,"First timeframe of a group member addition for this user"
        Group Member Addition,Group criticality context,gma-critical-member-group,"Security group is privileged"
        Group Member Addition,First OU,gma-first-ou-group,"First OU in a group member addition to this group"
        Group Member Addition,Self addition context,gma-member-self-add-group,"User added themself to a group"
        Group Member Addition,First source endpoint access,gma-source-endpoint-access-group,"First group member addition from this network zone"
        Group Member Addition,First group name,gma-member-group-name-group,"First group member addition to this group"
        Group Member Addition,User criticality context,gma-critical-user-group,"User is local user"
        Log Clear,Asset criticality context,lc-critical-endpoint-group,"Source endpoint is critical"
        Log Clear,Log cleared,lc-group,"An audit log was cleared"
        Log Clear,First dest endpoint access,lc-destination-endpoint-access-group,"First audit log clear on this endpoint"
        Log Clear,First user,lc-first-user-activity-group,"First audit log clear for this user"
        Login,login type context,lgn-login-type-group,"Login type for user"
        Login,First source endpoint access,lgn-source-endpoint-access-group,"First login from this source network zone to this destination network zone; First login from this network zone for the organization; First login from this network zone for this user"
        Login,First event count magnitude,lgnf-event-count-magnitude-group,"Abnormal number of failed login events in this platform for this user"
        Login,First unique dest zone count magnitude,lgn-dest-zone-count-magnitude-group,"Abnormal number of unique destination network zones in login events for this user; Abnormal number of unique destination network zones in login events for users in this country; Abnormal number of unique destination network zones in login events for users in this department; Abnormal number of unique destination network zones in login events for users with this manager"
        Login,First email domain,lgn-email-domain-group,"First login using this email domain for this platform"
        Login,IOC - pentest tools,lgn-ioc-pentest,"A hacking tool domain was used in a login"
        Login,First dest endpoint access,lgn-destination-endpoint-access-group,"First login to this network zone for this user; First login to this network zone for users in this country; First login to this network zone for users in this department; First login to this network zone for users with this manager"
        Login,First platform,lgn-platform-group,"First login to this platform for this user"
        Mailbox Permission Modification,First event count magnitude,mpm-event-count-magnitude-group,"Abnormal number of mailbox permission modifications for this user"
        Mailbox Permission Modification,Dest user criticality,mpm-critical-user-group,"The mailbox permissions of an executive user were changed by another user"
        Mailbox Permission Modification,First user,mpm-first-user-activity-group,"First mailbox permission modification for this user"
        Network,First bytes sum magnitude - inbound,ntw-bytes-sum-magnitude-group,"Abnormal amount of bytes sent in inbound communication from this network zone; Abnormal amount of bytes sent in outbound communication from this endpoint; Abnormal amount of bytes sent using SSH, Telnet, SMTP, DNS, HTTP or HTTPS protocols in outbound communication from this endpoint to this port; Abnormal amount of bytes sent in outbound communication from this network zone"
        Network,First bytes sum magnitude - outbound,ntwf-bytes-sum-magnitude-group,"Abnormal amount of bytes failed to be sent in outbound communication from this endpoint"
        Network,Session criticality context,ntw-critical-session-group,"Network protocol"
        Network,First dest endpoint access,ntw-destination-endpoint-access-group,"First communication to this IP address for this process from this endpoint"
        Network,First dest type,ntw-destination-type-group,"First communication to a network of this type for this process from this endpoint"
        Network,Failed activity context,ntwf-failed-activity-group,"Network activity failed"
        Network,BitTorrent,ntw-bittorrent-group,"A BitTorrent port was accessed"
        Password Checkout,First time of the day,pwd-time-of-day-group,"First timeframe of a password retrieval for this user"
        Password Checkout,First event count magnitude,pwd-event-count-magnitude-group,"Abnormal number of password retrievals for the organization; Abnormal number of password retrievals for this user; Abnormal number of password retrievals for users in this department; Abnormal number of password retrievals for users with this manager"
        Password Checkout,First source endpoint access,pwd-source-endpoint-access-group,"First password retrieval from this endpoint for this user"
        Password Checkout,First safe value,pwd-safe-value-group,"First password retrieval from this safe for this user"
        Password Checkout,First user,pwd-first-user-activity-group,"First password retrieval for this user; First password retrieval for users in this department; First password retrieval for users with manager peer group"
        Password Checkout,First unique safe value count magnitude,pwd-safe-value-count-magnitude-group,"Abnormal number of unique safes in password retrieval events for this user"
        Physical Location Access,First unique location count magnitude,pl-location-count-magnitude-group,"Abnormal number of unique cities physically accessed for this user; Abnormal number of unique doors physically accessed for this user"
        Physical Location Access,First time of the day,pl-time-of-day-group,"First timeframe of a physical access for this user"
        Physical Location Access,First location,pl-first-location-group,"First physical access to this building for this user; First physical access in this city for this user; First physical access to this door for this user"
        Physical Location Access,Outcome context,pl-outcome-group,"User succeeded/failed to physically access a location"
        Physical Location Access,Disabled user,pl-disabled-user-group,"A disabled user accessed a physical location"
        Privilege Use,First user,pu-first-user-activity-group,"First Windows privilege use for this user; First Windows privilege use for this users in this department; First Windows privilege use for this users with this manager"
        Privilege Use,First admin event count magnitude,pu-admin-event-count-magnitude-group,"Abnormal number of administrative privilege access events for this user"
        Privilege Use,First source endpoint access,pu-source-endpoint-access-group,"First Windows privilege use from this endpoint and network zone; First Windows privilege use from this endpoint for this user"
        Process Creation,Binary execution,pc-binary-execution-group,"'devtoolslauncher.exe' deployed a process"
        Process Creation,Control panel item,pc-control-panel-item-group,"The Windows control panel process spawned 'rundll32.exe'"
        Process Creation,IOC - Meterpreter,pc-ioc-meterpreter,"The 'getsystem' Meterpreter/Cobalt Strike command was executed on this endpoint"
        Process Creation,Echo to pipe,pc-echo-to-pipe-group,"Artifacts related to Meterpreter and Cobalt Strike have been observed on this endpoint"
        Process Creation,Parent process criticality context,pc-critical-parent-process-context-group,"Parent process is a credential enumeration tool; Parent process is a Microsoft Office process; Parent process is a known pentesting tool; Parent process is a shell process; Parent process is a system enumeration tool; Parent process is a web server process"
        Process Creation,Dll registration,pc-dll-registration-group,"'regsvr32.exe' loaded a DLL from the 'AppData\Local' directory"
        Process Creation,Catalog deletion,pc-catalog-deletion-group,"'wbadmin.exe' was used to delete a backup catalog"
        Process Creation,File association change,pc-file-assoc-change-group,"'assoc.exe' was used to change the association of an extension to execution"
        Process Creation,Task creation,pc-task-creation-group,"'schtask.exe' was executed via PowerSploit or Empire default configuration on this endpoint"
        Process Creation,NTDS dump,pc-ntds-dump-group,"'ntdsutil.exe' was executed on this endpoint"
        Process Creation,IOC - TropicTrooper APT,pc-ioc-tropictrooper-apt,"Artifacts related to the group 'TropicTrooper' have been observed on this endpoint"
        Process Creation,Debugger script execution,pc-debug-script-execution-group,"'cdb.exe' was used to execute a script"
        Process Creation,First critical command count magnitude,pc-crit-command-count-magnitude-group,"Abnormal number of critical Windows command executions for the organization"
        Process Creation,DNS exfiltration,pc-dns-exfil-group,"'dnscat.exe' was executed; 'iodine.exe' was executed"
        Process Creation,Event log tampering,pc-event-log-tampering-group,"'powershell.exe' was used to clear an event log; 'wevtutil.exe' was used to disable or clear an event tracing; 'wmic.exe' was used to clear an event log"
        Process Creation,Suspicious service process,pc-susp-service-process-group,"'sc.exe' was executed with suspicious parameters in the command line on this endpoint"
        Process Creation,Folder criticality context,pc-critical-folder-group,"Process execution from a temporary directory; Process executed from suspicious folder"
        Process Creation,Regsvr32 execution,pc-regsvr32-execution-group,"A Microsoft Office application executed regsvr32.exe on this endpoint"
        Process Creation,IOC - Hangul,pc-ioc-hangul,"Hangul Word Processor (Hanword) executed 'gbb.exe' on this endpoint"
        Process Creation,Compiled HTML execution,pc-html-execution-group,"'hh.exe' loaded a compiled HTML file"
        Process Creation,Base64 encoding,pc-base64-encoding-group,"'powershell.exe' was used to decode a Base64 string; 'powershell.exe' was used to execute a known malicious encoded command"
        Process Creation,AMSI bypass,pc-amsi-bypass-group,"'powershell.exe' was used to disable AMSI scanning"
        Process Creation,CPL file execution,pc-cpl-file-execution-group,"The Windows control panel process loaded control panel items outside of the default folders"
        Process Creation,IOC - BloodHound,pc-ioc-bloodhound,"'sharphound.exe' was executed on this endpoint"
        Process Creation,Journal deletion,pc-journal-deletion-group,"'fsutil.exe' was executed with suspicious parameters on this endpoint"
        Process Creation,Sensitive registry hive grab,pc-sensitive-hive-group,"The security/sam/system registry hives have been dumped on this endpoint using 'reg.exe'"
        Process Creation,Shadow copy deletion,pc-shadow-copy-delete-group,"A Shadow copy was deleted on this endpoint using 'vssadmin.exe'; A Shadow copy was deleted on this endpoint using 'wmic.exe'"
        Process Creation,User discovery,pc-user-discovery-group,"'cmdkey.exe' was executed with the parameter '/list' to search for cached credentials on this endpoint; 'dir.exe' was executed on the users folder on this endpoint"
        Process Creation,Encoding,pc-powershell-encoded-command-group,"First execution of 'powershell.exe' with an encrypted command for this user; First execution of 'powershell.exe' with an encrypted command for this parent process; A suspicious base64 powershell command was executed on this endpoint"
        Process Creation,Web execution,pc-web-execution-group,"'msiexec.exe' was executed with web addresses as a parameter on this endpoint; WMI invoked a remote XSL script on this endpoint; First execution of an Office process with a remote document from this web domain; First execution of an Office process with a remote document from this web domain for this user; .NET supporting process created with an URL in the commandline"
        Process Creation,Domain discovery,pc-domain-discover-group,"'dsquery.exe' was used to discover domain trusts; 'nltest.exe' was used to discover domain trusts"
        Process Creation,UAC bypass context,pc-uac-bypass-context-group,"Applocker bypass"
        Process Creation,BITS file download,pc-bits-file-download-group,"BITSAdmin was used to download a file"
        Process Creation,Suspicious command,pc-susp-command-group,"'certutil.exe' executed with suspicious command line flags on this endpoint"
        Process Creation,IOC - EquationGroup,pc-ioc-equationgroup,"EquationGroup APT; 'rundll32.exe' was executed the command line 'dll_u' on this endpoint"
        Process Creation,Asset criticality context,pc-critical-endpoint-group,"Endpoint is critical; Process execution on a server"
        Process Creation,Exfiltration tools context,pc-exfil-tool-context-group,"The data exfiltration tool 'plink' was executed on this endpoint"
        Process Creation,Policy bypass,pc-policy-bypass-group,"First execution of 'powershell.exe' with the '-ExecutionPolicy Bypass' parameter for this user"
        Process Creation,Shadow copy creation,pc-shadow-copy-create-group,"A Shadow copy was created on this endpoint using 'powershell.exe'; A Shadow copy was created on this endpoint using 'wmic.exe'; First shadow copy creation using 'vssadmin.exe' from this endpoint"
        Process Creation,Disable recovery,pc-disable-recovery-group,"'bcdedit.exe' was used to disable Windows recovery mode; 'bcdedit.exe' was used to disable Windows error recovery"
        Process Creation,Exfiltration tools,pc-exfil-tool-execution-group,"'httptunnel.exe' was executed; 'socat.exe' was executed; 'stunnel.exe' was executed"
        Process Creation,PowerShell DLL load,pc-powershell-dll-load-group,"Potential PowerShell execution from a DLL on this endpoint; PowerShell executed 'rundll32.exe' to load a dll from a temporary folder on this endpoint"
        Process Creation,Process memory dump,pc-process-memory-dump-group,"The attacker tool, CreateMiniDump, was executed on this endpoint; A process memory dump was taken on this endpoint via 'comsvcs.dll' using 'rundll32.exe'"
        Process Creation,mstsc rdp hijacking,pc-mstsc-rdp-hijack-group,"'mstsc.exe' was executed with command line arguments that indicates the 'shadowing' of an existing RDP session on this endpoint"
        Process Creation,Indirect command,pc-indirect-command-group,"'forfiles.exe' spawned a child process; 'pcalua.exe' was used to execute an indirect command"
        Process Creation,IOC - Empire,pc-ioc-empire,"PowerShell executed command line arguments, used to load an empire module, on this endpoint"
        Process Creation,IOC - Winnti Malware,pc-ioc-winnti-malware,"Artifacts related to 'Winnti' malware have been observed on this endpoint"
        Process Creation,File ownership,pc-file-owner-group,"'takeown.exe' was used to take ownership of a file or a folder"
        Process Creation,IOC - Koadic,pc-ioc-koadic,"Artifacts related to the attacker tool 'Koadic' have been observed on this endpoint"
        Process Creation,IOC - SIGRed CVE,pc-ioc-sigred,"'ns.exe' executed a suspicious process on this endpoint"
        Process Creation,Task modification,pc-task-modify-group,"The task scheduler was executed with the parameters '/change', '/tn', '/ru' and '/rp' on this endpoint"
        Process Creation,First event count magnitude,pc-event-count-magnitude-group,"Abnormal number of PowerShell executions for the organization; Abnormal number of PowerShell executions for this user; Abnormal number of PowerShell executions for users in this department; Abnormal number of PowerShell executions for users with this manager"
        Process Creation,Lsass memory dump,pc-lsass-memory-dump,"The LSASS memory space was accessed and credentials may have been dumped on this endpoint; LSASS was dumped on this endpoint using 'procdump.exe'"
        Process Creation,WMI event consumer,pc-wmi-event-consumer-group,"A WMI script event consumers was executed on this endpoint"
        Process Creation,Autorun modification,pc-autorun-mod-group,"'reg.exe' was used to modify an AutoRun registry key"
        Process Creation,System process,pc-system-process-group,"Process with 'system' level integrity is spawned by local/network service"
        Process Creation,IOC - EmpireMonkey APT,pc-ioc-empiremonkey-apt,"Artifacts related to the APT 'EmpireMonkey' have been observed on this endpoint"
        Process Creation,IOC - Wocao,pc-ioc-wocao,"Artifacts related to 'Wocao' operation have been observed on this endpoint"
        Process Creation,First source endpoint access,pc-source-endpoint-access-group,"First execution of a critical Windows command from this endpoint; First execution of a critical Windows command from this endpoint for this user; First execution of a critical Windows command from this endpoint for users in this country; First execution of a critical Windows command from this endpoint for users in this department; First execution of a critical Windows command from this endpoint for users with this manager"
        Process Creation,First destination endpoint access,pc-destination-endpoint-access-group,"First execution of 'msbuild.exe' to build and execute a project on this endpoint"
        Process Creation,Suspicious execution,pc-susp-execution-group,"Regsvr32.exe used to download/install/register new DLLs, that are hosted on Web, on this endpoint"
        Process Creation,Module installation,pc-module-installation-group,"An IIS native-code modules was installed on this endpoint using 'appcmd.exe'"
        Process Creation,IOC - FireEye Pentest,pc-ioc-fireye-pentest,"Execution of 'wmiprvse' version related to FireEye Pentesting"
        Process Creation,Abnormal DLL load,pc-abnormal-dll-load-group,"'rundll32.exe' executed an exported DLL function using an ordinal number; 'rundll32.exe' loaded a DLL from the AppData folder"
        Process Creation,IOC - CVE-2019-1378,pc-ioc-cve-2019-1378,"Privilege escalation using SetupComplete.cmd and PartnerSetupComplete.cmd"
        Process Creation,Credentials database copy,pc-cred-database-copy-group,"'esentutl.exe' was used to copy files with credentials data"
        Process Creation,Service modification,pc-service-modification-group,"'sc.exe' was executed by user with Medium integrity level to change service ImagePath or FailureCommand on this endpoint; A service path to powershell command was modified on this endpoint using 'sc.exe'"
        Process Creation,Script execution,pc-script-execution-group,"'wscript/cscript.exe' executed a VBScript with a suspicious parameter on this endpoint; Either 'wscript.exe' or 'cscript.exe' was executed from the user directory or the ProgramData directory and ran a script on this endpoint"
        Process Creation,Double extension,pc-double-extension-group,"A process with an '.exe' extension following a non-executable extension was executed"
        Process Creation,Defragmentation activation,pc-defrag-activation-group,"'schtasks.exe' was used to deactivate a scheduled defragmentation task"
        Process Creation,IOC - SecurityXploded tool,pc-ioc-securityxploded-tool,"The process 'passworddump.exe' from the 'SecurityXploded' toolkit was executed on this endpoint"
        Process Creation,Screenshot,pc-screenshot-group,"A screenshot was captured on this endpoint using 'psr.exe'"
        Process Creation,First unique tool count magnitude,pc-enum-tool-count-magnitude-group,"Abnormal number of unique credential enumeration tools executed for this user; Abnormal number of unique host enumeration tools executed for this user"
        Process Creation,IOC - ZxShell Malware,pc-ioc-zxshell-malware,"Artifacts related to 'ZxShell' have been observed on this endpoint"
        Process Creation,Enabling WDigest,pc-enabling-wdigest-group,"'reg.exe' was used to enable WDigest authentication"
        Process Creation,BITS job execution,pc-bits-job-execution-group,"'powershell.exe' was used to execute a BITS transfer"
        Process Creation,Native windows processes,pc-native-windows-process-group,"A Windows system program executable was executed from an uncommon folder on this endpoint; A suspicious parent process of well-known Windows processes on this endpoint"
        Process Creation,IOC - Judgement panda,pc-ioc-judgementpanda,"Artifacts related to the Judgement Panda activity have been observed on this endpoint; Artifacts related to a Russian group activity have been observed on this endpoint"
        Process Creation,Sysmon driver unload,pc-sysmon-driver-unload-group,"'fltmc.exe' used to unload Sysmon driver on this endpoint"
        Process Creation,IOC - Mustang Panda Malware,pc-ioc-mustangpanda,"Artifacts related to 'Mustang Panda' droppers have been seen on this endpoint"
        Process Creation,First parent process name,pc-parent-process-name-group,"First parent process for this known child process; First child process for this known parent process"
        Process Creation,Remote powershell context,pc-remote-powershell-group,"Remote PowerShell session with wsmprovhost as child process; Remote PowerShell session was detected by monitoring for wsmprovhost as a parent process which are signs of an active PowerShell remote session. This can be a legitimate usage of remote PowerShell for monitoring purposes but should still be noted. This sigma rule is authored by Roberto Rodriguez @Cyb3rWard0g and is licensed under Detection Rule License (DRL), https://github.com/SigmaHQ/sigma/blob/master/LICENSE.Detection.Rules.md. Reference: https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_remote_powershell_session_process.yml"
        Process Creation,Remote DCOM activation,pc-remote-dcom-group,"Remote DCOM activation under DcomLaunch service"
        Process Creation,Hidden execution,pc-hidden-execution-group,"'powershell.exe' was executed with a hidden or non-interactive window"
        Process Creation,Abnormal parent,pc-abnormal-parent-group,"'bitsadmin.exe' was spawned by a shell process; 'certutil.exe' was spawned by a shell process; 'csc.exe' was spawned by a shell or a Microsoft Office process; 'csi.exe' was spawned by PowerShell; 'regsvr32.exe' spawned 'cscript.exe' or 'wscript.exe'"
        Process Creation,Process criticality context,pc-critical-process-context-group,"Process is a credential enumeration tool; Process is a known pentesting tool; Process is a shell process; Process is a system enumeration tool"
        Process Creation,Shim installation,pc-shim-installation-group,"A shim database registered on this endpoint using sdbinst.exe"
        Process Creation,File permissions modification,pc-file-perm-mod-group,"'icacls.exe' was used to grant global permissions on a file; First file or folder permissions modification using 'icacls.exe' or 'cacls.exe' for this user"
        Process Creation,Invoke HTTP,pc-invoke-http-group,"'consent.exe' spawned 'iexplore.exe' with system permissions"
        Process Creation,IOC - Hurricane Panda,pc-ioc-hurricanepanda,"Artifacts related to the APT group 'Hurricane Panda' have been observed on this endpoint"
        Process Creation,SPN discovery,pc-spn-discovery-group,"Find SPNs using setspn.exe"
        Process Creation,Audio capture,pc-audio-capture-group,"'powershell.exe' was used to record external audio; 'soundrecorder.exe' was used to record external audio"
        Process Creation,Tasks folder evasion,pc-task-folder-evasion-group,"Tasks folder evasion using 'copy.exe'; Tasks folder evasion using 'echo.exe'; Tasks folder evasion using 'type.exe'"
        Process Creation,Network discovery,pc-network-discover-group,"First execution of 'ipconfig.exe' for this user; First execution of 'route.exe' for this user"
        Process Creation,Network sniffing,pc-network-sniff-group,"'tshark.exe' was executed on this endpoint; 'windump.exe' was executed on this endpoint"
        Process Creation,Shadow copy access,pc-shadow-copy-access-group,"A Shadow copy was symbolically linked on this endpoint using 'mklink.exe'"
        Process Creation,IOC - Elise APT,pc-ioc-elise-apt,"Artifacts related to the APT 'Elise' have been observed on this endpoint"
        Process Creation,UAC bypass,pc-uac-bypass-group,"Microsoft Connection Manager Profile Installer (cmstp.exe) was executed with the parameter '/s' or '/au' on this endpoint; Windows UAC bypass using COM object on this endpoint; 'fodhelper.exe' executed a process on this endpoint; 'wsreset.exe' executed a process that is not conhost.exe on this endpoint"
        Process Creation,IOC - Dtrack Malware,pc-ioc-dtrack-malware,"Artifacts related to 'Dtrack' malware have been observed on this endpoint"
        Process Creation,Hex encoding,pc-hex-encoding-group,"'ping.exe' was used to ping a hex encoded IP address"
        Process Creation,Firewall disable,pc-firewall-disable-group,"'netsh.exe' was used to disable the Windows firewall"
        Process Creation,IOC - Zoho,pc-ioc-zoho,"Process injection using ZOHO's 'dctask64.exe'"
        Process Creation,Temporary folder,pc-temp-folder-group,"A process from the Outlook temp folder was executed on this endpoint"
        Process Creation,IOC - NotPetya,pc-ioc-notpetya,"Artifacts related to the ransomware NotPetya have been observed on this endpoint"
        Process Creation,No arguments,pc-no-args-group,"Svchost.exe executed without any CLI arguments on this endpoint"
        Process Creation,First user,pc-first-user-activity-group,"First firewall policies enumeration using 'netsh.exe' for this user; First local groups enumeration using 'net.exe' for this user; First local users enumeration using 'net.exe' for this user"
        Process Creation,Alternate data streams,pc-alternate-data-streams-group,"'powershell.exe' was used to execute a PowerShell script from an ADS"
        Process Creation,IOC - Chafer APT,pc-ioc-chafer-apt,"Artifacts related to the APT 'Chafer' have been observed on this endpoint"
        Process Creation,IOC - Rubeus tool,pc-ioc-rubeus,"Command line parameters used by the attacker tool 'Rubeus' were executed on this endpoint"
        Process Creation,VB execution,pc-vb-execution-group,"Bypass application whitelisting using 'bginfo'"
        Process Creation,Javascript execution,pc-vbscript-execution-group,"'mshta.exe' was used to directly execute a script"
        Process Creation,Account discovery context,pc-account-discovery-group,"Local accounts enumeration using quser.exe; Local accounts enumeration using qwinsta.exe; Local accounts enumeration using whoami.exe; Local accounts enumeration using wmic.exe"
        Process Creation,Java remote debugging,pc-java-remote-debug-group,"A JAVA process is running with remote debugging allowing more than just localhost to connect"
        Process Creation,First sysvol execution,pc-sysvol-execution-group,"First access to a SYSVOL domain group policy using a process for users in this department; First access to a SYSVOL domain group policy using a process for users with this manager"
        Process Creation,IOC - Emotet,pc-ioc-emotet,"Artifacts related to the 'Emotet' malware have been observed on this endpoint"
        Process Creation,First sniffing tool,pc-sniff-tool-group,"A network sniffing tool was executed on this endpoint; First execution of a network sniffing tool from this endpoint; First execution of a network sniffing tool for this user; First execution of a network sniffing tool for users in this department; First execution of a network sniffing tool for users with this manager; First execution of a network sniffing tool from this network zone"
        Process Creation,Disable IIS logging,pc-disable-iis-login-group,"'appcmd.exe' was used to disable IIS HTTP logging"
        Process Creation,Impacket activity,pc-impacket-group,"A remote process was executed and redirected to an admin share"
        Process Creation,IOC - Baby Shark Malware,pc-ioc-babyshark-malware,"'powershell.exe' was used to execute known 'Baby Shark' malware encoded commands"
        Process Creation,IOC - Unidentified 2018 APT,pc-ioc-2018apt,"Artifacts related to APT29 have been observed on this endpoint"
        Process Creation,IOC - pentest tools,pc-ioc-pentest,"First execution of this known pentest tool for this user"
        Process Creation,Boot entry modification,pc-boot-entry-mod-group,"'bcdedit.exe' was used to delete or import boot entry data"
        Process Creation,IOC - Archer Malware,pc-ioc-archer-malware,"'rundll32.exe' executed the Archer malware"
        Process Creation,System permissions,pc-system-permissions-group,"'taskmgr.exe' was executed by the user 'system' on this endpoint; 'whoami.exe' was executed by the user 'system' on this endpoint"
        Process Creation,Formbook injection,pc-formbook-injection-group,"'del.exe' was used to execute a formbook; 'type.exe' was used to execute a formbook"
        Registry,Enabling WDigest,r-enabling-wdigest-group,"WDigest Authentication enabled via the registry on this endpoint by this user"
        Role Assumption,First role,ra-first-role-group,"First role assumption of this role for this user"
        Role Assumption,First event count magnitude,ra-role-count-magnitude-group,"Abnormal number of unique roles assumed for this user"
        Role Assumption,First user,ra-first-user-activity-group,"First role assumption event for this user"
        Role Creation and Modification,First user,rcm-first-user-activity-group,"First role creation or modification for this user on this platform"
        Role Permission Modification,Public role,rpm-public-role-group,"First role permission modification to public for this role"
        Role Permission Modification,First user,rpm-first-user-activity-group,"First role permission modification for this user on this platform"
        Rule Delete,First event count magnitude,ruled-event-count-magnitude-group,"Abnormal number of security rules deletions for this user"
        Scheduled Tasks Creation,First process name,stc-process-name-group,"First scheduled task creation configured to execute this process for the organization; First scheduled task creation configured to execute this process for this user; First scheduled task creation configured to execute this process for this task name"
        Scheduled Tasks Creation,First time of the day,stc-time-of-day-group,"First timeframe of a scheduled task creation on this endpoint"
        Scheduled Tasks Creation,First dest endpoint access,stc-destination-endpoint-access-group,"First scheduled task creation on this endpoint; First scheduled task creation on this endpoint for this user; First scheduled task creation on this endpoint for users in this country; First scheduled task creation on this endpoint for users in this department; First scheduled task creation on this endpoint for users with this manager"
        Scheduled Tasks Creation,First task name,stc-task-name-group,"First creation of a scheduled task with this name for the organization; First creation of a scheduled task with this name for users in this department; First creation of a scheduled task with this name for users with this manager"
        Scheduled Tasks Creation,Sensitive process,stc-sensitive-process-group,"Scheduled task created to execute PowerShell on this endpoint by this user"
        Script Execution - PowerShell,First web request count magnitude,scp-web-request-count-magnitude-group,"Abnormal number of PowerShell web requests for the organization"
        Script Execution - PowerShell,First command invocation,scp-command-invocation-group,"First PowerShell script execution with this command for this user"
        Script Execution - PowerShell,First command invocation count magnitude,scp-command-invocation-count-magnitude-group,"Abnormal number of PowerShell command invocations for the organization"
        Script Execution - PowerShell,First wmi user,scp-wmi-user-group,"First PowerShell script execution with WMI commands for this user"
        Script Execution - PowerShell,First user,scp-first-user-activity-group,"First PowerShell script execution for this user"
        Script Execution - PowerShell,First script name,scp-script-name-group,"First PowerShell script execution with this script name for this user"
        Security Alerts,First unique alert name count magnitude,sa-alert-count-magnitude-group,"Abnormal number of unique alerts triggered from this endpoint; Abnormal number of unique alerts triggered for this user; Abnormal number of unique alerts triggered for users in this department; Abnormal number of unique alerts triggered for users with this manager"
        Security Alerts,Asset criticality context,sa-critical-endpoint-group,"Security alert reported on a Critical system"
        Security Alerts,First alert subject,sa-alert-subject-group,"First trigger of a security alert with this subject from this endpoint"
        Security Alerts,First source endpoint access,sa-source-endpoint-access-group,"First security alert trigger from this endpoint; First security alert trigger in this network zone; First security alert trigger from this endpoint in this network zone; First security alert trigger from this endpoint for this user; First security alert trigger from this endpoint for a user in this country; First security alert trigger from this endpoint for a user in this department; First security alert trigger from this endpoint for a user with this manager"
        Security Alerts,Ensured Trigger,sa-alert-ensured-trigger-group,"A correlation rule was triggered"
        Security Alerts,First dest port,sa-dest-port-group,"First network alert trigger on this port for this destination network zone; First network alert trigger on this port on this endpoint; First network alert trigger on this port in the organization"
        Security Alerts,VPN connected,sa-vpn-connection-group,"Security alert reported when logged in via VPN for user"
        Security Alerts,First alert name,sa-alert-name-group,"First trigger of this security alert from this endpoint; First trigger of this security alert in the organization; First trigger of this correlation rule in the organization; First trigger of this security alert from this endpoint; First trigger of this correlation rule from this endpoint; First trigger of this security alert in this network zone; First trigger of this security alert for this user; First trigger of this correlation rule for this user; First trigger of this security alert for users in this department; First trigger of this correlation rule for users in this department; First trigger of this security alert for users with this manager; First trigger of this correlation rule for users with this manager"
        Security Alerts,User criticality context,sa-critical-user-group,"Security violation by Executive"
        Security Alerts,First process name,sa-process-name-group,"First security alert trigger on this process for this user"
        Security Alerts,First dest host asset label,sa-endpoint-label-group,"First security alert trigger on a server for this destination network zone"
        Security Alerts,First user,sa-first-user-activity-group,"First security alert trigger for this user; First security alert trigger for users in this country; First security alert trigger for users in this department; First security alert trigger for users with this manager"
        Security Alerts,Previous alerts context,sa-previous-alert-group,"A third party security alert reported for user"
        Security Alerts,Alert criticality context,sa-alert-critical-group,"Alert product and severity; Correlation rule severity"
        Security Alerts - DLP,First unique protocol count magnitude,sadlp-protocol-count-magnitude-group,"Abnormal number of unique protocols in DLP alerts for this user"
        Security Alerts - DLP,First process name,sadlp-process-name-group,"First DLP alert trigger on this process for the organization; First DLP alert trigger on this process for this user; First DLP alert trigger on this process for users in this department; First DLP alert trigger on this process for users with this manager"
        Security Alerts - DLP,First protocol,sadlp-first-protocol-group,"First DLP alert trigger on this protocol for this user"
        Security Alerts - DLP,First top domain,sadlp-top-domain-group,"First DLP alert trigger on this domain for this protocol"
        Share Access,First share name,sha-share-name-group,"First access to this network share from this endpoint; First access to this network share for this user"
        Share Access,First unique share count magnitude,sha-share-count-magnitude-group,"Abnormal number of unique network shares accessed for this user"
        Share Access,User criticality context,sha-critical-user-group,"Share access by privileged user"
        Share Access,Share criticality context,sha-critical-share-group,"The share is an admin share; The share is an known named pipe"
        Share Access,First unique file count magnitude,sha-file-count-magnitude-group,"Abnormal number of unique files accessed in this network share for this user"
        USB,First device id,usb-device-id-group,"First peripheral device ID for the organization; First peripheral device ID from this endpoint; First peripheral device ID for this user; First peripheral device ID for users in this department; First peripheral device ID for users with this manager"
        USB,First user,usb-first-user-activity-group,"First peripheral device activity for this user"
        USB,First source endpoint access,usb-source-endpoint-access-group,"First peripheral device activity from this endpoint; First peripheral device activity from this endpoint for this user; First peripheral device activity from this endpoint for users in this country; First peripheral device activity from this endpoint for users in this department; First peripheral device activity from this endpoint for users with this manager"
        User,Privilege miss-match,u-privilege-mismatch-group,"A non-privileged user accessed an attribute of a privileged directory service user account"
        User Creation,First dest endpoint access,uc-dest-endpoint-access-group,"First user creation on this endpoint; First user creation on this endpoint for this user"
        User Creation,First domain controller,uc-dc-group,"First user creation processed by this DC for this user"
        User Creation,First dest domain,uc-dest-domain-group,"First user creation on this domain for this user"
        User Creation,User criticality context,uc-critical-user-group,"User is a local user"
        User Creation,First source endpoint access,uc-source-endpoint-access-group,"First user creation from this endpoint; First user creation from this endpoint for this user; First user creation in this network zone for the organization"
        User Creation,First time of the day,uc-time-of-day-group,"First timeframe of a user creation for this user"
        User Creation,First user,uc-first-user-activity-group,"First user creation for this user; First user creation for users in this department; First user creation for users with this manager; First user creation for this system account on this endpoint"
        User Deletion,First user,ud-first-user-activity-group,"First user deletion for this user"
        User Key Creation,First user,ukc-first-user-activity-group,"First account key creation for this user"
        User Lock,First user,ul-first-user-activity-group,"First user lock for this user"
        User Password Modification,First user,upm-first-user-activity-group,"First user account password modification for this user"
        User Password Modification,First event count magnitude,upm-event-count-magnitude-group,"Abnormal amount of password resets for user"
        User Switch,First user,usw-first-user-activity-group,"First account switch for this user"
        User Switch,First dest user,usw-dest-user-group,"First account switch to this account for this user"
        User Switch,Dest user criticality context,usw-critical-user-group,"User switched credentials to a privileged or executive account; User switched credentials from a privileged or executive account"
        VPN Login,First source country code,vpn-source-country-group,"First VPN login from this country for this user"
        VPN Login,First source endpoint access,vpn-source-endpoint-access-group,"First VPN login from this endpoint for the organization; First VPN login from this endpoint for this user; First VPN login from this endpoint for users in this country; First VPN login from this endpoint for users in this department; First VPN login from this endpoint for users with this manager"
        VPN Login,First time of the day,vpn-time-of-day-group,"First timeframe of a VPN login for this user"
        VPN Login,First user,vpn-first-user-activity-group,"First VPN login for this user; First VPN login for users in this country; First VPN login for users in this department; First VPN login for users with this manager"
        VPN Login,First realm,vpn-first-realm-group,"First VPN login with this realm for this user; First VPN login with this realm for users in this country; First VPN login with this realm for users in this department; First VPN login with this realm for users with this manager"
        VPN Login,First OS,vpn-first-os-group,"First VPN login from this OS for this user"
        VPN Login,First event count magnitude,vpnf-event-count-magnitude-group,"Abnormal number of failed vpn logins for this user"
        VPN Login,User criticality context,vpn-critical-user-group,"user is a contractor; user is executive; user is a service account; user is a partner"
        VPN Login,First dest endpoint access,vpn-destination-endpoint-access-group,"First VPN login to this vpn server for this user; First VPN login to this vpn server for users in this country; First VPN login to this vpn server for users in this department; First VPN login to this vpn server for users with this manager"
        VPN Login,Anonymous country,vpn-anonymous-country-group,"A VPN login was attempted from an anonymous country"
        VPN Login,Disabled user context,vpn-disabled-user-group,"VPN31"
        VPN Logout,First session duration magnitude,vout-session-duration-magnitude-group,"Abnormal VPN session duration for this user"
        VPN Logout,First bytes sum magnitude,vout-bytes-sum-magnitude-group,"Abnormal amount of bytes uploaded in VPN sessions for this user"
        Web,Asset criticality context,web-critical-endpoint-group,"WEB-DC"
        Web,Threat indicators - Phishing,web-ti-phishing-group,"An HTTP communication attempt to a domain known to be associated with phishing was made from this endpoint"
        Web,First bytes sum magnitude,web-bytes-sum-magnitude-group,"Abnormal amount of bytes uploaded to file sharing websites for the organization; Abnormal amount of bytes uploaded to the web with GET requests for this user; Abnormal amount of bytes uploaded to the web with POST requests for this user; Abnormal amount of bytes downloaded from file sharing websites for this user; Abnormal amount of bytes uploaded to file sharing websites for this user; Abnormal amount of bytes uploaded to file sharing websites for users in this department; Abnormal amount of bytes uploaded to file sharing websites for users with this manager"
        Web,First source endpoint access,web-source-endpoint-access-group,"First HTTP communication from this endpoint for the organization; First HTTP communication from this network zone for the organization; First HTTP communication from this network zone for this user; First HTTP communication from this network zone for users in this country; First HTTP communication from this network zone for users in this department"
        Web,First event count magnitude,web-event-count-magnitude-group,"Abnormal number of successful HTTP events for this user; Abnormal number of HTTP responses with 3xx/4xx codes for this user"
        Web,Threat indicators - TOR,web-ti-tor-group,"An HTTP communication attempt to a known TOR web proxy was made from this endpoint; An HTTP communication attempt to a URL containing '/tor/server' was made from this endpoint"
        Web,First time of the day,web-time-of-day-group,"First timeframe of an HTTP activity for this user"
        Web,Binary URL,web-binary-url-group,"An executable was downloaded using HTTP"
        Web,First dest country,web-destination-country-group,"First HTTP communication to this country for the organization; First HTTP communication to this country for this user"
        Web,User criticality context,web-critical-user-group,"WEB-ALERT-EXEC; WEB-Privileged-User"
        Web,First outbound country,web-outbound-country-group,"First HTTP communication to this country for the organization; First HTTP communication to this country from this endpoint"
        Web,First web domain,web-domain-group,"First HTTP communication to this top level domain for the organization; First HTTP communication directly to an IP address for this user"
        Web,First outbound country,webf-outbound-country-group,"First failed HTTP communication to this country for the organization; First failed HTTP communication to this country from this endpoint"
        Web,First event count magnitude,webf-event-count-magnitude-group,"Abnormal number of failed HTTP events for this user"
        Web,Threat indicators,web-ti-group,"An HTTP communication attempt to a known malicious uri was made from this endpoint; An HTTP communication attempt to a malicious site was made from this endpoint; An HTTP communication attempt to a domain with bad reputation was made from this endpoint; First HTTP communication to this malicious web domain for this user"
        Web,First unique web domain count magnitude,webf-domain-count-magnitude-group,"Abnormal number of unique domains in failed HTTP events for this user"
        Web,Threat indicators - Ransomware,web-ti-ransomware-group,"An HTTP communication attempt to a domain known to be associated with ransomware was made from this endpoint"
        Web,Web domain criticality context,web-critical-domain-group,"HTTP activity directly to this IP address"
        Web Meeting,Remove password,wm-remove-password-group,"Meeting modified to remove the meeting password"
        Web Meeting,First user,wm-first-user-activity-group,"First web meeting event for this user"
        Web Meeting,First time of the day,wm-time-of-day-group,"First timeframe of a web meeting creation for this user"
        Web Request,First bytes sum magnitude,wr-bytes-sum-magnitude-group,"Abnormal amount of bytes requested in HTTP GET requests for this endpoint"
        Web Request,First event count magnitude,wrf-event-count-magnitude-group,"Abnormal number of failed HTTP requests for this user"
        Windows Service Creation,Suspicious service command,wsc-susp-service-command-group,"Service creation with suspicious execution command parameters; Service creation from a temporary internet files directory"
        Windows Service Creation,First time of the day,wsc-time-of-day-group,"First timeframe of a service creation on this endpoint"
        Windows Service Creation,First source endpoint access,wsc-source-endpoint-access-group,"First service creation from this endpoint for this source zone"
        Windows Service Creation,First dest user,wsc-dest-user-group,"First service creation with this destination user on this endpoint"
        Windows Service Creation,First destination endpoint access,wsc-dest-endpoint-access-group,"First service creation on this endpoint for the organization; First service creation on this endpoint for this user; First service creation on this endpoint for users in this country; First service creation on this endpoint for users in this department; First service creation on this endpoint for users with this manager"
        Windows Service Creation,First process path,wsc-process-path-group,"First process path for this service"
</script>

    <script>
        let currentStep = 1;
        const totalSteps = 6;

        // Families and Groups will be loaded from CSV files
        const familiesData = {};
        const familyNameToId = {};
        let ruleGroupsByFamilyId = {};

        // CSV parser that supports quotes and commas within fields
        function parseCSV(text) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            for (let i = 0; i < text.length; i++) {
                const ch = text[i];
                const next = text[i + 1];
                if (inQuotes) {
                    if (ch === '"' && next === '"') {
                        currentField += '"';
                        i++;
                    } else if (ch === '"') {
                        inQuotes = false;
                    } else {
                        currentField += ch;
                    }
                } else {
                    if (ch === '"') {
                        inQuotes = true;
                    } else if (ch === ',') {
                        currentRow.push(currentField);
                        currentField = '';
                    } else if (ch === '\n' || ch === '\r') {
                        if (currentField.length > 0 || currentRow.length > 0) {
                            currentRow.push(currentField);
                            rows.push(currentRow);
                            currentRow = [];
                            currentField = '';
                        }
                    } else {
                        currentField += ch;
                    }
                }
            }
            if (currentField.length > 0 || currentRow.length > 0) {
                currentRow.push(currentField);
                rows.push(currentRow);
            }
            return rows;
        }

        function normalizeFamilyName(name) {
            return (name || '')
                .toLowerCase()
                .replace(/[\u2013\u2014]/g, '-')
                .replace(/\bactivity\b/g, '')
                .replace(/\s+/g, ' ')
                .replace(/\s*-\s*/g, '-')
                .trim();
        }

        async function loadFamilies() {
            try {
                const embedded = document.getElementById('families_csv');
                const text = embedded ? embedded.textContent : '';
                if (text && text.trim()) {
                    const rows = parseCSV(text.trim());
                    rows.slice(1).forEach(cols => {
                        const name = cols[0];
                        const id = cols[1];
                        const description = cols[2] || '';
                        if (!id || !name) return;
                        familiesData[id] = { name, description };
                        familyNameToId[normalizeFamilyName(name)] = id;
                    });
                    return;
                }
                // Fallback to fetch if not embedded
                const resp = await fetch('families/families.csv', { cache: 'no-store' });
                const fetchedText = await resp.text();
                const rows = parseCSV(fetchedText);
                rows.slice(1).forEach(cols => {
                    const name = cols[0];
                    const id = cols[1];
                    const description = cols[2] || '';
                    if (!id || !name) return;
                    familiesData[id] = { name, description };
                    familyNameToId[normalizeFamilyName(name)] = id;
                });
            } catch (e) {
                console.error('Failed to load families data', e);
            }
        }

        async function loadGroups() {
            try {
                const embedded = document.getElementById('groups_csv');
                const text = embedded ? embedded.textContent : '';
                const byFamilyId = {};
                if (text && text.trim()) {
                    const rows = parseCSV(text.trim());
                    rows.slice(1).forEach(cols => {
                        const familyName = cols[0];
                        const groupName = cols[1];
                        const groupId = cols[2];
                        if (!familyName || !groupId || !groupName) return;
                        const familyId = familyNameToId[normalizeFamilyName(familyName)];
                        if (!familyId) return;
                        if (!byFamilyId[familyId]) byFamilyId[familyId] = [];
                        byFamilyId[familyId].push({ id: groupId, name: groupName });
                    });
                    ruleGroupsByFamilyId = byFamilyId;
                    return;
                }
                // Fallback to fetch if not embedded
                const resp = await fetch('groups_v3.csv', { cache: 'no-store' });
                const fetchedText = await resp.text();
                const rows = parseCSV(fetchedText);
                rows.slice(1).forEach(cols => {
                    const familyName = cols[0];
                    const groupName = cols[1];
                    const groupId = cols[2];
                    if (!familyName || !groupId || !groupName) return;
                    const familyId = familyNameToId[normalizeFamilyName(familyName)];
                    if (!familyId) return;
                    if (!byFamilyId[familyId]) byFamilyId[familyId] = [];
                    byFamilyId[familyId].push({ id: groupId, name: groupName });
                });
                ruleGroupsByFamilyId = byFamilyId;
            } catch (e) {
                console.error('Failed to load groups data', e);
            }
        }

        // Rule group mappings are defined below with full list

// Populate families dropdown
function populateFamilies() {
            const familySelect = document.getElementById('familyId');
            familySelect.innerHTML = '<option value="">Select rule family...</option>';
            
            Object.keys(familiesData).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = familiesData[key].name;
                familySelect.appendChild(option);
            });
        }

        // Rule groups will be populated from CSV via ruleGroupsByFamilyId
        const ruleGroupMappings = {
            "Application Authentication": [
                { "id": "appaf-event-count-magnitude-group", "name": "First event count magnitude" }
            ],
            "Application Login": [
                { "id": "app-event-count-magnitude-group", "name": "First event count magnitude" },
                { "id": "al-source-isp-group", "name": "First source ISP for application login" },
                { "id": "al-time-of-day-group", "name": "First time of the day for app login" },
                { "id": "app-critical-user-group", "name": "User criticality context" },
                { "id": "al-source-endpoint-access-group", "name": "First source host for application login" },
                { "id": "al-mfa-status-group", "name": "First MFA status" },
                { "id": "al-source-country-group", "name": "First source country code for application login" }
            ],
            "Audit Policy Modification": [
                { "id": "audit-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "audit-first-user-activity-group", "name": "First user" },
                { "id": "audit-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Authentication": [
                { "id": "auth-mfa-count-magnitude-group", "name": "First MFA event count magnitude" },
                { "id": "auth-tgs-count-magnitude-group", "name": "First distinct TGS service count magnitude" }
            ],
            "Bucket Creation": [
                { "id": "bc-first-user-activity-group", "name": "First user" }
            ],
            "Bucket Permission Modification": [
                { "id": "bucket-permission-first-user-activity-group", "name": "First user" },
                { "id": "bucket-permission-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "bucket-perm-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Cloud Policy Management": [
                { "id": "cloud-policy-first-user-activity-group", "name": "First user" },
                { "id": "cloud-policy-source-endpoint-access-group", "name": "First source endpoint access" }
            ],
            "Compute Disk": [
                { "id": "compute-disk-first-user-activity-group", "name": "First user" },
                { "id": "compute-disk-source-endpoint-access-group", "name": "First source endpoint access" }
            ],
            "Compute Image": [
                { "id": "compute-image-first-user-activity-group", "name": "First user" },
                { "id": "compute-image-source-endpoint-access-group", "name": "First source endpoint access" }
            ],
            "Compute Snapshot": [
                { "id": "compute-snapshot-first-user-activity-group", "name": "First user" },
                { "id": "compute-snapshot-source-endpoint-access-group", "name": "First source endpoint access" }
            ],
            "Compute Virtual Machine": [
                { "id": "compute-vm-first-user-activity-group", "name": "First user" },
                { "id": "compute-vm-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "compute-vm-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Database": [
                { "id": "database-first-user-activity-group", "name": "First user" },
                { "id": "database-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "database-critical-user-group", "name": "User criticality context" },
                { "id": "database-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Database Query": [
                { "id": "dq-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "dq-first-user-activity-group", "name": "First user" },
                { "id": "dq-first-table-access-group", "name": "First database table access" },
                { "id": "dq-table-access-magnitude-group", "name": "First database table access count magnitude" },
                { "id": "dq-distinct-table-magnitude-group", "name": "First distinct database table count magnitude" },
                { "id": "dq-critical-user-group", "name": "User criticality context" },
                { "id": "dq-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Directory Service": [
                { "id": "ds-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "ds-first-user-activity-group", "name": "First user" },
                { "id": "ds-first-object-operation-group", "name": "First object operation" },
                { "id": "ds-critical-user-group", "name": "User criticality context" },
                { "id": "ds-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Directory Service Object Write": [
                { "id": "dsow-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "dsow-first-user-activity-group", "name": "First user" },
                { "id": "dsow-first-object-write-group", "name": "First object write" },
                { "id": "dsow-critical-user-group", "name": "User criticality context" },
                { "id": "dsow-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "DLL Load": [
                { "id": "dll-load-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "dll-load-first-user-activity-group", "name": "First user" },
                { "id": "dll-load-first-dll-group", "name": "First DLL" },
                { "id": "dll-load-first-process-group", "name": "First process" },
                { "id": "dll-load-critical-user-group", "name": "User criticality context" },
                { "id": "dll-load-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "DNS": [
                { "id": "dns-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "dns-first-user-activity-group", "name": "First user" },
                { "id": "dns-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "dns-critical-user-group", "name": "User criticality context" },
                { "id": "dns-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "DNS Request": [
                { "id": "dns-req-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "dns-req-first-user-activity-group", "name": "First user" },
                { "id": "dns-req-first-query-group", "name": "First DNS query" },
                { "id": "dns-req-query-magnitude-group", "name": "First DNS query count magnitude" },
                { "id": "dns-req-distinct-query-magnitude-group", "name": "First distinct DNS query count magnitude" },
                { "id": "dns-req-critical-user-group", "name": "User criticality context" },
                { "id": "dns-req-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "DNS Response": [
                { "id": "dns-resp-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "dns-resp-first-user-activity-group", "name": "First user" },
                { "id": "dns-resp-first-response-group", "name": "First DNS response" },
                { "id": "dns-resp-critical-user-group", "name": "User criticality context" },
                { "id": "dns-resp-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Email Receive": [
                { "id": "emailr-first-user-activity-group", "name": "First user" },
                { "id": "emailr-first-sender-group", "name": "First sender" },
                { "id": "emailr-first-sender-domain-group", "name": "First sender domain" },
                { "id": "emailr-sender-magnitude-group", "name": "First sender count magnitude" },
                { "id": "emailr-distinct-sender-magnitude-group", "name": "First distinct sender count magnitude" },
                { "id": "emailr-critical-user-group", "name": "User criticality context" }
            ],
            "Email Rule Creation": [
                { "id": "erc-first-user-activity-group", "name": "First user" },
                { "id": "erc-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "erc-critical-user-group", "name": "User criticality context" },
                { "id": "erc-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Email Send": [
                { "id": "emails-event-count-magnitude-group", "name": "First event count magnitude" },
                { "id": "emails-first-user-activity-group", "name": "First user" },
                { "id": "emails-first-destination-country-group", "name": "First destination country code" },
                { "id": "emails-first-destination-domain-group", "name": "First destination domain" },
                { "id": "emails-destination-magnitude-group", "name": "First destination count magnitude" },
                { "id": "emails-distinct-destination-magnitude-group", "name": "First distinct destination count magnitude" },
                { "id": "emails-critical-user-group", "name": "User criticality context" }
            ],
            "Endpoint Login": [
                { "id": "el-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "el-dest-host-count-magnitude-group", "name": "First unique dest host count magnitude" },
                { "id": "el-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "el-first-user-activity-group", "name": "First user" },
                { "id": "el-first-login-type-group", "name": "First login type" },
                { "id": "el-first-source-country-group", "name": "First source country code" },
                { "id": "el-mfa-status-group", "name": "First MFA status" },
                { "id": "el-time-of-day-group", "name": "First time of the day for endpoint login" },
                { "id": "el-critical-user-group", "name": "User criticality context" },
                { "id": "el-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Endpoint Login - NAC": [
                { "id": "el-nac-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "el-nac-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "el-nac-first-user-activity-group", "name": "First user" },
                { "id": "el-nac-critical-user-group", "name": "User criticality context" },
                { "id": "el-nac-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Endpoint Screenshot": [
                { "id": "es-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "es-first-user-activity-group", "name": "First user" },
                { "id": "es-critical-user-group", "name": "User criticality context" },
                { "id": "es-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "File": [
                { "id": "file-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "file-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "file-first-user-activity-group", "name": "First user" },
                { "id": "file-critical-user-group", "name": "User criticality context" },
                { "id": "file-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "File Delete": [
                { "id": "filed-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "filed-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "filed-first-user-activity-group", "name": "First user" },
                { "id": "filed-first-file-group", "name": "First file" },
                { "id": "filed-first-file-type-group", "name": "First file type" },
                { "id": "filed-file-magnitude-group", "name": "First file count magnitude" },
                { "id": "filed-distinct-file-magnitude-group", "name": "First distinct file count magnitude" },
                { "id": "filed-critical-user-group", "name": "User criticality context" },
                { "id": "filed-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "File Download": [
                { "id": "filedld-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "filedld-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "filedld-first-user-activity-group", "name": "First user" },
                { "id": "filedld-first-file-group", "name": "First file" },
                { "id": "filedld-first-file-type-group", "name": "First file type" },
                { "id": "filedld-file-magnitude-group", "name": "First file count magnitude" },
                { "id": "filedld-distinct-file-magnitude-group", "name": "First distinct file count magnitude" },
                { "id": "filedld-critical-user-group", "name": "User criticality context" },
                { "id": "filedld-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "File Permission Modification": [
                { "id": "fpm-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "fpm-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "fpm-first-user-activity-group", "name": "First user" },
                { "id": "fpm-first-file-group", "name": "First file" },
                { "id": "fpm-critical-user-group", "name": "User criticality context" },
                { "id": "fpm-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "File Read": [
                { "id": "filer-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "filer-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "filer-first-user-activity-group", "name": "First user" },
                { "id": "filer-first-file-group", "name": "First file" },
                { "id": "filer-first-file-type-group", "name": "First file type" },
                { "id": "filer-file-magnitude-group", "name": "First file count magnitude" },
                { "id": "filer-distinct-file-magnitude-group", "name": "First distinct file count magnitude" },
                { "id": "filer-critical-user-group", "name": "User criticality context" },
                { "id": "filer-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "File Upload": [
                { "id": "fileupld-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "fileupld-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "fileupld-first-user-activity-group", "name": "First user" },
                { "id": "fileupld-first-file-group", "name": "First file" },
                { "id": "fileupld-first-file-type-group", "name": "First file type" },
                { "id": "fileupld-file-magnitude-group", "name": "First file count magnitude" },
                { "id": "fileupld-distinct-file-magnitude-group", "name": "First distinct file count magnitude" },
                { "id": "fileupld-critical-user-group", "name": "User criticality context" },
                { "id": "fileupld-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "File Write": [
                { "id": "filew-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "filew-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "filew-first-user-activity-group", "name": "First user" },
                { "id": "filew-first-file-group", "name": "First file" },
                { "id": "filew-first-file-type-group", "name": "First file type" },
                { "id": "filew-file-magnitude-group", "name": "First file count magnitude" },
                { "id": "filew-distinct-file-magnitude-group", "name": "First distinct file count magnitude" },
                { "id": "filew-critical-user-group", "name": "User criticality context" },
                { "id": "filew-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "File Write - USB": [
                { "id": "filew-usb-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "filew-usb-first-user-activity-group", "name": "First user" },
                { "id": "filew-usb-first-file-group", "name": "First file" },
                { "id": "filew-usb-first-file-type-group", "name": "First file type" },
                { "id": "filew-usb-critical-user-group", "name": "User criticality context" },
                { "id": "filew-usb-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "General": [
                { "id": "ga-first-platform-group", "name": "First platform" },
                { "id": "ga-first-mime-group", "name": "First mime" },
                { "id": "ga-event-count-magnitude-group", "name": "First event count magnitude" },
                { "id": "ga-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "ga-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "ga-first-user-activity-group", "name": "First user" },
                { "id": "ga-critical-user-group", "name": "User criticality context" },
                { "id": "ga-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Group Member Addition": [
                { "id": "gma-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "gma-first-user-activity-group", "name": "First user" },
                { "id": "gma-first-group-group", "name": "First group" },
                { "id": "gma-first-member-group", "name": "First member" },
                { "id": "gma-critical-user-group", "name": "User criticality context" },
                { "id": "gma-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Log Clear": [
                { "id": "lc-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "lc-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "lc-first-user-activity-group", "name": "First user" },
                { "id": "lc-first-log-type-group", "name": "First log type" },
                { "id": "lc-critical-user-group", "name": "User criticality context" },
                { "id": "lc-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Login": [
                { "id": "login-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "login-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "login-first-user-activity-group", "name": "First user" },
                { "id": "login-critical-user-group", "name": "User criticality context" },
                { "id": "login-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Mailbox Permission Modification": [
                { "id": "mpm-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "mpm-first-user-activity-group", "name": "First user" },
                { "id": "mpm-first-mailbox-group", "name": "First mailbox" },
                { "id": "mpm-critical-user-group", "name": "User criticality context" },
                { "id": "mpm-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Network": [
                { "id": "network-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "network-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "network-first-user-activity-group", "name": "First user" },
                { "id": "network-critical-user-group", "name": "User criticality context" },
                { "id": "network-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Password Checkout": [
                { "id": "pc-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "pc-first-user-activity-group", "name": "First user" },
                { "id": "pc-first-account-group", "name": "First account" },
                { "id": "pc-critical-user-group", "name": "User criticality context" },
                { "id": "pc-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Physical Location Access": [
                { "id": "pla-first-user-activity-group", "name": "First user" },
                { "id": "pla-first-location-group", "name": "First location" },
                { "id": "pla-critical-user-group", "name": "User criticality context" }
            ],
            "Privilege Use": [
                { "id": "pu-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "pu-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "pu-first-user-activity-group", "name": "First user" },
                { "id": "pu-first-privilege-group", "name": "First privilege" },
                { "id": "pu-critical-user-group", "name": "User criticality context" },
                { "id": "pu-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Process Creation": [
                { "id": "pc-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "pc-first-user-activity-group", "name": "First user" },
                { "id": "pc-first-process-group", "name": "First process" },
                { "id": "pc-first-parent-process-group", "name": "First parent process" },
                { "id": "pc-first-command-line-group", "name": "First command line" },
                { "id": "pc-process-magnitude-group", "name": "First process count magnitude" },
                { "id": "pc-distinct-process-magnitude-group", "name": "First distinct process count magnitude" },
                { "id": "pc-critical-user-group", "name": "User criticality context" },
                { "id": "pc-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Registry": [
                { "id": "registry-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "registry-first-user-activity-group", "name": "First user" },
                { "id": "registry-first-key-group", "name": "First registry key" },
                { "id": "registry-first-value-group", "name": "First registry value" },
                { "id": "registry-critical-user-group", "name": "User criticality context" },
                { "id": "registry-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Role Assumption": [
                { "id": "ra-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "ra-first-user-activity-group", "name": "First user" },
                { "id": "ra-first-role-group", "name": "First role" },
                { "id": "ra-critical-user-group", "name": "User criticality context" },
                { "id": "ra-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Role Permission Modification": [
                { "id": "rpm-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "rpm-first-user-activity-group", "name": "First user" },
                { "id": "rpm-first-role-group", "name": "First role" },
                { "id": "rpm-critical-user-group", "name": "User criticality context" },
                { "id": "rpm-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Role Creation and Modification": [
                { "id": "rcm-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "rcm-first-user-activity-group", "name": "First user" },
                { "id": "rcm-first-role-group", "name": "First role" },
                { "id": "rcm-critical-user-group", "name": "User criticality context" },
                { "id": "rcm-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Rule Delete": [
                { "id": "rd-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "rd-first-user-activity-group", "name": "First user" },
                { "id": "rd-first-rule-group", "name": "First rule" },
                { "id": "rd-critical-user-group", "name": "User criticality context" },
                { "id": "rd-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Scheduled Tasks Creation": [
                { "id": "stc-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "stc-first-user-activity-group", "name": "First user" },
                { "id": "stc-first-task-group", "name": "First task" },
                { "id": "stc-critical-user-group", "name": "User criticality context" },
                { "id": "stc-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Script Execution - PowerShell": [
                { "id": "sep-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "sep-first-user-activity-group", "name": "First user" },
                { "id": "sep-first-script-group", "name": "First script" },
                { "id": "sep-first-command-group", "name": "First command" },
                { "id": "sep-critical-user-group", "name": "User criticality context" },
                { "id": "sep-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Security Alerts": [
                { "id": "sa-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "sa-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "sa-first-user-activity-group", "name": "First user" },
                { "id": "sa-first-alert-type-group", "name": "First alert type" },
                { "id": "sa-alert-magnitude-group", "name": "First alert count magnitude" },
                { "id": "sa-distinct-alert-magnitude-group", "name": "First distinct alert count magnitude" },
                { "id": "sa-critical-user-group", "name": "User criticality context" },
                { "id": "sa-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Security Alerts - DLP": [
                { "id": "sa-dlp-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "sa-dlp-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "sa-dlp-first-user-activity-group", "name": "First user" },
                { "id": "sa-dlp-first-policy-group", "name": "First DLP policy" },
                { "id": "sa-dlp-critical-user-group", "name": "User criticality context" },
                { "id": "sa-dlp-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Share Access": [
                { "id": "share-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "share-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "share-first-user-activity-group", "name": "First user" },
                { "id": "share-first-share-group", "name": "First share" },
                { "id": "share-critical-user-group", "name": "User criticality context" },
                { "id": "share-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "USB": [
                { "id": "usb-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "usb-first-user-activity-group", "name": "First user" },
                { "id": "usb-first-device-group", "name": "First USB device" },
                { "id": "usb-critical-user-group", "name": "User criticality context" },
                { "id": "usb-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "User": [
                { "id": "user-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "user-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "user-first-user-activity-group", "name": "First user" },
                { "id": "user-critical-user-group", "name": "User criticality context" },
                { "id": "user-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "User Creation": [
                { "id": "uc-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "uc-first-user-activity-group", "name": "First user" },
                { "id": "uc-first-new-user-group", "name": "First new user" },
                { "id": "uc-critical-user-group", "name": "User criticality context" },
                { "id": "uc-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "User Deletion": [
                { "id": "ud-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "ud-first-user-activity-group", "name": "First user" },
                { "id": "ud-first-deleted-user-group", "name": "First deleted user" },
                { "id": "ud-critical-user-group", "name": "User criticality context" },
                { "id": "ud-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "User Key Creation": [
                { "id": "ukc-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "ukc-first-user-activity-group", "name": "First user" },
                { "id": "ukc-first-key-group", "name": "First key" },
                { "id": "ukc-critical-user-group", "name": "User criticality context" },
                { "id": "ukc-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "User Lock": [
                { "id": "ul-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "ul-first-user-activity-group", "name": "First user" },
                { "id": "ul-first-locked-user-group", "name": "First locked user" },
                { "id": "ul-critical-user-group", "name": "User criticality context" },
                { "id": "ul-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "User Password Modification": [
                { "id": "upm-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "upm-first-user-activity-group", "name": "First user" },
                { "id": "upm-first-target-user-group", "name": "First target user" },
                { "id": "upm-critical-user-group", "name": "User criticality context" },
                { "id": "upm-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "User Switch": [
                { "id": "us-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "us-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "us-first-user-activity-group", "name": "First user" },
                { "id": "us-first-target-user-group", "name": "First target user" },
                { "id": "us-critical-user-group", "name": "User criticality context" },
                { "id": "us-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "VPN Login": [
                { "id": "vpn-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "vpn-first-user-activity-group", "name": "First user" },
                { "id": "vpn-first-source-country-group", "name": "First source country code" },
                { "id": "vpn-first-source-isp-group", "name": "First source ISP" },
                { "id": "vpn-time-of-day-group", "name": "First time of the day for VPN login" },
                { "id": "vpn-critical-user-group", "name": "User criticality context" },
                { "id": "vpn-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "VPN Logout": [
                { "id": "vpnl-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "vpnl-first-user-activity-group", "name": "First user" },
                { "id": "vpnl-critical-user-group", "name": "User criticality context" },
                { "id": "vpnl-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Web": [
                { "id": "web-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "web-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "web-first-user-activity-group", "name": "First user" },
                { "id": "web-critical-user-group", "name": "User criticality context" },
                { "id": "web-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Web Meeting": [
                { "id": "wm-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "wm-first-user-activity-group", "name": "First user" },
                { "id": "wm-first-meeting-group", "name": "First meeting" },
                { "id": "wm-critical-user-group", "name": "User criticality context" },
                { "id": "wm-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Web Request": [
                { "id": "wr-source-endpoint-access-group", "name": "First source endpoint access" },
                { "id": "wr-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "wr-first-user-activity-group", "name": "First user" },
                { "id": "wr-first-url-group", "name": "First URL" },
                { "id": "wr-first-domain-group", "name": "First domain" },
                { "id": "wr-first-user-agent-group", "name": "First user agent" },
                { "id": "wr-url-magnitude-group", "name": "First URL count magnitude" },
                { "id": "wr-distinct-url-magnitude-group", "name": "First distinct URL count magnitude" },
                { "id": "wr-critical-user-group", "name": "User criticality context" },
                { "id": "wr-critical-endpoint-group", "name": "Asset criticality context" }
            ],
            "Windows Service Creation": [
                { "id": "wsc-dest-endpoint-access-group", "name": "First dest endpoint access" },
                { "id": "wsc-first-user-activity-group", "name": "First user" },
                { "id": "wsc-first-service-group", "name": "First service" },
                { "id": "wsc-critical-user-group", "name": "User criticality context" },
                { "id": "wsc-critical-endpoint-group", "name": "Asset criticality context" }
            ]
        };

        // MITRE ATT&CK mappings
        const mitreData = {
            tactics: [
                { id: 'TA0043', name: 'Reconnaissance' },
                { id: 'TA0001', name: 'Initial Access' },
                { id: 'TA0002', name: 'Execution' },
                { id: 'TA0003', name: 'Persistence' },
                { id: 'TA0004', name: 'Privilege Escalation' },
                { id: 'TA0005', name: 'Defense Evasion' },
                { id: 'TA0006', name: 'Credential Access' },
                { id: 'TA0007', name: 'Discovery' },
                { id: 'TA0008', name: 'Lateral Movement' },
                { id: 'TA0009', name: 'Collection' },
                { id: 'TA0011', name: 'Command and Control' },
                { id: 'TA0010', name: 'Exfiltration' },
                { id: 'TA0040', name: 'Impact' }
            ],
            techniquesByTactic: {
                'TA0043': [
                    { id: 'T1598', name: 'Phishing for Information' }
                ],
                'TA0001': [
                    { id: 'T1078', name: 'Valid Accounts' },
                    { id: 'T1566', name: 'Phishing' },
                    { id: 'T1133', name: 'External Remote Services' },
                    { id: 'T1190', name: 'Exploit Public-Facing Application' }
                ],
                'TA0002': [
                    { id: 'T1059', name: 'Command and Scripting Interpreter' },
                    { id: 'T1053', name: 'Scheduled Task/Job' }
                ],
                'TA0003': [
                    { id: 'T1078', name: 'Valid Accounts' },
                    { id: 'T1136', name: 'Create Account' },
                    { id: 'T1543', name: 'Create or Modify System Process' }
                ],
                'TA0004': [
                    { id: 'T1078', name: 'Valid Accounts' },
                    { id: 'T1068', name: 'Exploitation for Privilege Escalation' },
                    { id: 'T1055', name: 'Process Injection' }
                ],
                'TA0005': [
                    { id: 'T1078', name: 'Valid Accounts' },
                    { id: 'T1036', name: 'Masquerading' },
                    { id: 'T1027', name: 'Obfuscated Files or Information' },
                    { id: 'T1070', name: 'Indicator Removal' },
                    { id: 'T1562', name: 'Impair Defenses' }
                ],
                'TA0006': [
                    { id: 'T1003', name: 'OS Credential Dumping' },
                    { id: 'T1110', name: 'Brute Force' }
                ],
                'TA0007': [
                    { id: 'T1057', name: 'Process Discovery' },
                    { id: 'T1083', name: 'File and Directory Discovery' }
                ],
                'TA0008': [
                    { id: 'T1021', name: 'Remote Services' }
                ],
                'TA0009': [
                    { id: 'T1005', name: 'Data from Local System' },
                    { id: 'T1530', name: 'Data from Cloud Storage' }
                ],
                'TA0010': [
                    { id: 'T1048', name: 'Exfiltration Over Alternative Protocol' },
                    { id: 'T1567', name: 'Exfiltration Over Web Service' }
                ],
                'TA0040': [
                    { id: 'T1489', name: 'Service Stop' },
                    { id: 'T1490', name: 'Inhibit System Recovery' }
                ]
            }
        };

        // Helper function to copy to clipboard - Updated to work with data attributes
        function copyToClipboard(text) {
            const targetEl = (this && this.classList) ? this : null;
            navigator.clipboard.writeText(text).then(() => {
                if (targetEl) targetEl.classList.add('copied');
                
                // Show toast notification
                const toast = document.getElementById('toast');
                toast.textContent = `Copied: ${text.substring(0, 30)}${text.length > 30 ? '...' : ''}`;
                toast.classList.add('show');
                
                // Remove animation class after animation completes
                setTimeout(() => {
                    if (targetEl) targetEl.classList.remove('copied');
                    toast.classList.remove('show');
                }, 1000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        // Add event listeners to all chips
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers to all chips with data-copy attribute
            document.querySelectorAll('.chip[data-copy]').forEach(chip => {
                chip.addEventListener('click', function() {
                    const textToCopy = this.getAttribute('data-copy');
                    copyToClipboard.call(this, textToCopy);
                });
            });
        });

        // Update rule groups when family changes and show description
        document.getElementById('familyId').addEventListener('change', function() {
            const ruleGroupSelect = document.getElementById('ruleGroupId');
            const descriptionDiv = document.getElementById('familyDescription');
            
            ruleGroupSelect.innerHTML = '<option value="">Select rule group...</option>';
            
            if (this.value && familiesData[this.value]) {
                // Show family description
                descriptionDiv.textContent = familiesData[this.value].description;
                descriptionDiv.classList.add('show');
                
                // Find groups by family id
                const groups = ruleGroupsByFamilyId[this.value] || [
                    { id: 'default-first-activity-group', name: 'First activity detection' },
                    { id: 'default-anomaly-group', name: 'Anomaly detection' }
                ];
                
                groups.forEach(group => {
                    const option = document.createElement('option');
                    option.value = group.id;
                    option.textContent = `${group.name} - ${group.id}`;
                    ruleGroupSelect.appendChild(option);
                });
            } else {
                descriptionDiv.classList.remove('show');
            }
        });

        // Show/hide maturity threshold when checkboxes change
        document.getElementById('checkScopeMaturity').addEventListener('change', updateMaturityVisibility);
        document.getElementById('checkFeatureMaturity').addEventListener('change', updateMaturityVisibility);

        function updateMaturityVisibility() {
            const scopeChecked = document.getElementById('checkScopeMaturity').checked;
            const featureChecked = document.getElementById('checkFeatureMaturity').checked;
            const maturityGroup = document.getElementById('maturityThresholdGroup');
            
            if (scopeChecked || featureChecked) {
                maturityGroup.style.display = 'block';
            } else {
                maturityGroup.style.display = 'none';
            }
        }

        // Rule type change handler
        document.getElementById('ruleType').addEventListener('change', function() {
            const exampleBox = document.getElementById('ruleTypeExample');
            const exampleContent = document.getElementById('exampleContent');
            const numericSettings = document.getElementById('numericSettings');
            
            const examples = {
                'profiledFeature': 'Detect when a user logs in from a country they\'ve never accessed before',
                'factFeature': 'Detect when LSASS.exe memory is accessed (credential dumping attempt)',
                'contextFeature': 'Identify and flag VIP users based on Active Directory attributes',
                'numericCountProfiledFeature': 'Alert when login attempts spike beyond normal patterns',
                'numericDistinctCountProfiledFeature': 'Detect unusual number of unique systems accessed',
                'numericSumProfiledFeature': 'Track abnormal data transfer volumes'
            };
            
            if (this.value) {
                exampleBox.style.display = 'block';
                exampleContent.textContent = examples[this.value];
                
                // Show/hide numeric settings based on rule type
                if (this.value.includes('numeric')) {
                    numericSettings.style.display = 'block';
                } else {
                    numericSettings.style.display = 'none';
                }
            } else {
                exampleBox.style.display = 'none';
                numericSettings.style.display = 'none';
            }
        });

        function addMitreMapping() {
            const container = document.getElementById('mitreMappings');
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            
            // Create tactic dropdown first
            let tacticOptions = '<option value="">Select tactic first...</option>';
            mitreData.tactics.forEach(t => {
                tacticOptions += `<option value="${t.id}">${t.name}</option>`;
            });
            
            div.innerHTML = `
                <select class="mitre-tactic" onchange="updateTechniqueDropdown(this)">
                    ${tacticOptions}
                </select>
                <select class="mitre-technique">
                    <option value="">Select tactic first</option>
                </select>
                <button class="remove-button" onclick="this.parentElement.remove()">Remove</button>
            `;
            container.appendChild(div);
        }

        function updateTechniqueDropdown(tacticSelect) {
            const techniqueSelect = tacticSelect.parentElement.querySelector('.mitre-technique');
            const selectedTactic = tacticSelect.value;
            
            if (!selectedTactic) {
                techniqueSelect.innerHTML = '<option value="">Select tactic first</option>';
                return;
            }
            
            // Get techniques for selected tactic
            const techniques = mitreData.techniquesByTactic[selectedTactic] || [];
            
            techniqueSelect.innerHTML = '<option value="">Select technique...</option>';
            techniques.forEach(t => {
                const option = document.createElement('option');
                option.value = t.id;
                option.dataset.name = t.name;
                option.textContent = `${t.id} - ${t.name}`;
                techniqueSelect.appendChild(option);
            });
        }

        function toggleCustomThreshold() {
            const select = document.getElementById('anomalyThreshold');
            const customInput = document.getElementById('customThresholdInput');
            if (select.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }
        
        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            
            // Show current step
            document.getElementById(`step${step}`).classList.add('active');
            
            // Update progress bar
            document.querySelectorAll('.progress-step').forEach((s, index) => {
                if (index < step - 1) {
                    s.classList.add('completed');
                    s.classList.remove('active');
                } else if (index === step - 1) {
                    s.classList.add('active');
                    s.classList.remove('completed');
                } else {
                    s.classList.remove('active', 'completed');
                }
            });
            
            // Update buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.visibility = step === 1 ? 'hidden' : 'visible';
            
            if (step === totalSteps) {
                nextBtn.textContent = 'Generate JSON';
                nextBtn.className = 'btn-generate';
                generateRuleJSON();
            } else {
                nextBtn.textContent = 'Next';
                nextBtn.className = 'btn-next';
            }
            
            // Show/hide specific fields based on rule type (in step 3 now)
            if (step === 3) {
                const ruleType = document.getElementById('ruleType').value;
                const isProfiledFeature = (ruleType === 'profiledFeature' || ruleType.includes('numeric'));
                document.getElementById('profiledFeatureFields').style.display = isProfiledFeature ? 'block' : 'none';
                document.getElementById('factFeatureFields').style.display = 
                    ruleType === 'factFeature' ? 'block' : 'none';
                document.getElementById('contextFeatureFields').style.display = 
                    ruleType === 'contextFeature' ? 'block' : 'none';
                
                // Show/hide anomaly threshold based on rule type
                document.getElementById('anomalyThresholdGroup').style.display = isProfiledFeature ? 'block' : 'none';
                
                // Hide feature value for numeric count rules, but show scope value
                // Show/hide count per field based on rule type
                if (ruleType === 'numericCountProfiledFeature') {
                    const featureValueContainer = document.getElementById('featureValue').parentNode;
                    featureValueContainer.style.display = 'none';
                    const scopeValueContainer = document.getElementById('scopeValue').parentNode;
                    scopeValueContainer.style.display = 'block';
                    // Show count per for numeric count rules
                    const countPerContainer = document.getElementById('countPer').parentNode;
                    countPerContainer.style.display = 'block';
                } else if (isProfiledFeature) {
                    const featureValueContainer = document.getElementById('featureValue').parentNode;
                    featureValueContainer.style.display = 'block';
                    const scopeValueContainer = document.getElementById('scopeValue').parentNode;
                    scopeValueContainer.style.display = 'block';
                    
                    // Hide count per for non-count numeric rules
                    if (ruleType.includes('numeric') && ruleType !== 'numericCountProfiledFeature') {
                        const countPerContainer = document.getElementById('countPer').parentNode;
                        countPerContainer.style.display = 'none';
                    }
                }
                
                // Re-attach event listeners to newly visible chips
                setTimeout(() => {
                    document.querySelectorAll('.chip[data-copy]').forEach(chip => {
                        chip.onclick = function() {
                            const textToCopy = this.getAttribute('data-copy');
                            copyToClipboard.call(this, textToCopy);
                        };
                    });
                }, 100);
            }
            
            // Show/hide advanced settings based on rule type
            if (step === 5) {
                const ruleType = document.getElementById('ruleType').value;
                document.getElementById('maturitySettings').style.display = 
                    (ruleType === 'profiledFeature' || ruleType.includes('numeric')) ? 'block' : 'none';
                document.getElementById('suppressionSettings').style.display = 
                    (ruleType === 'factFeature') ? 'block' : 'none'; // Only show suppression settings for fact features
                document.getElementById('numericAdvancedSettings').style.display = 
                    (ruleType.includes('numeric')) ? 'block' : 'none'; // Only show numeric settings for numeric rules
            }
        }

        function validateStep(step) {
            switch(step) {
                case 1:
                    if (!document.getElementById('ruleType').value) {
                        alert('Please select a rule type');
                        return false;
                    }
                    break;
                case 2:
                    if (!document.getElementById('ruleName').value) {
                        alert('Please enter a rule name');
                        return false;
                    }
                    if (!document.getElementById('ruleDescription').value.trim()) {
                        alert('Please enter a rule description');
                        return false;
                    }
                    if (!document.getElementById('familyId').value || !document.getElementById('ruleGroupId').value) {
                        alert('Please select rule family and group');
                        return false;
                    }
                    break;
                case 3:
                    if (!document.getElementById('detectionReason').value) {
                        alert('Please enter a detection reason');
                        return false;
                    }
                    const ruleType = document.getElementById('ruleType').value;
                    if (ruleType === 'profiledFeature' || ruleType.includes('numeric')) {
                        if (!document.getElementById('scopeValue').value) {
                            alert('Please enter scope value');
                            return false;
                        }
                        
                        // Only require feature value for non-count numeric rules and profiled features
                        if ((ruleType === 'profiledFeature' || 
                            ruleType === 'numericDistinctCountProfiledFeature' || 
                            ruleType === 'numericSumProfiledFeature') && 
                            !document.getElementById('featureValue').value) {
                            alert('Please enter feature value');
                            return false;
                        }
                        
                        // Count per is now optional for all rules
                        
                        // Make query mandatory for numeric rules
                        if (ruleType.includes('numeric') && !document.getElementById('queryField').value) {
                            alert('Please enter a query');
                            return false;
                        }
                    }
                    if (ruleType === 'contextFeature') {
                        if (!document.getElementById('contextValue').value) {
                            alert('Please enter context value');
                            return false;
                        }
                    }
                    break;
                case 4:
                    // Activity Type is mandatory
                    if (!document.getElementById('activityType').value) {
                        alert('Please select an Activity Type. This field is required.');
                        return false;
                    }
                    
                    // No longer requiring additional filtering criteria
                    const eventFields = [
                        'eventType', 'activity', 'subject', 'outcome', 
                        'product', 'productCategory', 'vendor', 'landscape', 'platform'
                    ];
                    // Keeping the code to identify fields but not enforcing them as mandatory
                    break;
                case 5:
                    if (!document.getElementById('familyId').value || !document.getElementById('ruleGroupId').value) {
                        alert('Please select rule family and group');
                        return false;
                    }
                    break;
            }
            return true;
        }

        function nextStep() {
            if (currentStep === totalSteps) {
                // Generate and download JSON
                downloadJSON();
                return;
            }
            
            if (validateStep(currentStep)) {
                currentStep++;
                showStep(currentStep);
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function goToStep(targetStep) {
            // Validate all steps up to the target step
            for (let step = 1; step < targetStep; step++) {
                if (!validateStep(step)) {
                    // Show toast notification for validation error
                    const toast = document.getElementById('toast');
                    toast.textContent = `Please complete Step ${step} before proceeding to Step ${targetStep}`;
                    toast.classList.add('show');
                    setTimeout(() => toast.classList.remove('show'), 3000);
                    return false;
                }
            }
            
            currentStep = targetStep;
            showStep(currentStep);
            return true;
        }

        function generateTemplateId() {
            const ruleType = document.getElementById('ruleType').value;
            const scopeValue = document.getElementById('scopeValue')?.value || document.getElementById('contextScopeValue')?.value || '';
            const featureValue = document.getElementById('featureValue')?.value || document.getElementById('contextValue')?.value || '';
            const activityType = document.getElementById('activityType').value;
            
            // Map rule type to abbreviation
            const typeMap = {
                'profiledFeature': 'Prof',
                'factFeature': 'Fact',
                'contextFeature': 'Cntx',
                'numericCountProfiledFeature': 'NumCP',
                'numericDistinctCountProfiledFeature': 'NumDCP',
                'numericSumProfiledFeature': 'NumSP'
            };
            
            // Extract abbreviations from scope and feature
            const scopeAbbr = scopeValue.includes('User') ? 'Usr' : 
                              scopeValue.includes('Device') ? 'Dev' : 
                              scopeValue.includes('org') ? 'Org' : 'Ent';
            
            const featureAbbr = featureValue.substring(0, 3).toUpperCase() || 'VAL';
            
            const activityAbbr = activityType ? activityType.split('-')[0].substring(0, 3).toUpperCase() : 'GEN';
            
            return `C_${typeMap[ruleType]}-${scopeAbbr}-${featureAbbr}-${activityAbbr}`;
        }

        function generateRuleJSON() {
            const ruleType = document.getElementById('ruleType').value;
            const templateId = document.getElementById('templateId').value || generateTemplateId();
            
            // Build applicable events from CIM fields
            const applicableEvents = [];
            const cimFields = {};
            
            // Collect CIM field values
            if (document.getElementById('eventType').value) cimFields.event_type = document.getElementById('eventType').value;
            if (document.getElementById('activityType').value) cimFields.activity_type = document.getElementById('activityType').value;
            if (document.getElementById('activity').value) cimFields.activity = document.getElementById('activity').value;
            if (document.getElementById('subject').value) cimFields.subject = document.getElementById('subject').value;
            if (document.getElementById('outcome').value) cimFields.outcome = document.getElementById('outcome').value;
            if (document.getElementById('product').value) cimFields.product = document.getElementById('product').value;
            if (document.getElementById('productCategory').value) cimFields.product_category = document.getElementById('productCategory').value;
            if (document.getElementById('vendor').value) cimFields.vendor = document.getElementById('vendor').value;
            if (document.getElementById('landscape').value) cimFields.landscape = document.getElementById('landscape').value;
            if (document.getElementById('platform').value) cimFields.platform = document.getElementById('platform').value;
            
            // Only add to applicableEvents if there are fields
            if (Object.keys(cimFields).length > 0) {
                applicableEvents.push(cimFields);
            }
            
            // Get use cases
            const useCases = [];
            document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked').forEach(cb => {
                useCases.push(cb.value);
            });
            
            // Get required fields
            const requiredFields = [];
            document.querySelectorAll('.field-checkbox input[type="checkbox"]:checked').forEach(cb => {
                requiredFields.push(cb.value);
            });
            
            // Add additional required fields
            const additionalFields = document.getElementById('additionalRequiredFields').value;
            if (additionalFields) {
                additionalFields.split(',').forEach(field => {
                    const trimmed = field.trim();
                    if (trimmed && !requiredFields.includes(trimmed)) {
                        requiredFields.push(trimmed);
                    }
                });
            }
            
            // Get MITRE mappings
            const mitreMappings = [];
            document.querySelectorAll('#mitreMappings .dynamic-item').forEach(item => {
                const tacticSelect = item.querySelector('.mitre-tactic');
                const techniqueSelect = item.querySelector('.mitre-technique');
                
                if (tacticSelect.value && techniqueSelect.value) {
                    const tacticOption = tacticSelect.options[tacticSelect.selectedIndex];
                    const techniqueOption = techniqueSelect.options[techniqueSelect.selectedIndex];
                    
                    mitreMappings.push({
                        techniqueKey: techniqueSelect.value,
                        technique: techniqueOption.dataset.name,
                        tactic: tacticOption.textContent,
                        tacticKey: tacticSelect.value
                    });
                }
            });
            
            // Build rule definition
            const ruleDefinition = {
                templateId: templateId,
                name: document.getElementById('ruleName').value,
                type: ruleType,
                detectionReason: document.getElementById('detectionReason').value,
                familyId: document.getElementById('familyId').value,
                ruleGroupId: document.getElementById('ruleGroupId').value
            };
            
            // Add applicableEvents if not empty
            if (applicableEvents.length > 0) {
                ruleDefinition.applicableEvents = applicableEvents;
            }
            
            // Add optional fields
            const description = document.getElementById('ruleDescription').value;
            if (description) ruleDefinition.description = description;
            
            if (mitreMappings.length > 0) ruleDefinition.mitre = mitreMappings;
            if (useCases.length > 0) ruleDefinition.useCases = useCases;
            if (requiredFields.length > 0) ruleDefinition.requiredFields = requiredFields;
            
            // Add type-specific fields
            if (ruleType === 'profiledFeature' || ruleType.includes('numeric')) {
                // Add scopeValue for all rule types
                ruleDefinition.scopeValue = document.getElementById('scopeValue').value;
                
                // Only add feature value for non-count numeric rules and profiled features
                if (ruleType !== 'numericCountProfiledFeature') {
                    ruleDefinition.featureValue = document.getElementById('featureValue').value;
                }
                
                ruleDefinition.trainOnCondition = document.getElementById('trainOnCondition').value || 'true';
                ruleDefinition.actOnCondition = document.getElementById('actOnCondition').value || 'true';
                // Handle custom anomaly threshold
                const anomalyThresholdSelect = document.getElementById('anomalyThreshold');
                if (anomalyThresholdSelect.value === 'custom') {
                    const customValue = document.getElementById('customThresholdValue').value;
                    if (customValue && parseInt(customValue) >= 1 && parseInt(customValue) <= 365) {
                        ruleDefinition.anomalyThreshold = customValue + ' days';
                    } else {
                        ruleDefinition.anomalyThreshold = '90 days'; // Default if invalid custom value
                    }
                } else {
                    ruleDefinition.anomalyThreshold = anomalyThresholdSelect.value;
                }
                

                
                if (document.getElementById('checkScopeMaturity').checked) {
                    ruleDefinition.checkScopeMaturity = true;
                    ruleDefinition.maturityThreshold = document.getElementById('maturityThreshold').value;
                }
                
                if (document.getElementById('checkFeatureMaturity').checked) {
                    ruleDefinition.checkFeatureMaturity = true;
                    ruleDefinition.maturityThreshold = document.getElementById('maturityThreshold').value;
                }
                
                // Add numeric-specific fields
                if (ruleType.includes('numeric')) {
                    // Get window duration and period from the select fields
                    ruleDefinition.windowDuration = document.getElementById('windowDuration').value || '1 day';
                    ruleDefinition.windowPeriod = document.getElementById('windowPeriod').value || '12 hours';
                    
                    // Add countPer only for numeric count rules
                    if (ruleType === 'numericCountProfiledFeature') {
                        const countPer = document.getElementById('countPer').value;
                        ruleDefinition.countPer = countPer;
                    }
                    
                    // Add query for numeric features
                    const query = document.getElementById('queryField').value;
                    if (query && query.trim()) {
                        ruleDefinition.query = query;
                    }
                    
                    // Only add feature value for non-count numeric rules
                    if (ruleType !== 'numericCountProfiledFeature') {
                        ruleDefinition.featureValue = document.getElementById('featureValue').value;
                    }
                    
                    // Add advanced settings for all numeric rules
                    ruleDefinition.logBase = parseInt(document.getElementById('logBase').value) || 2;
                    ruleDefinition.minOrderOfMagnitude = parseFloat(document.getElementById('minOrderOfMagnitude').value) || 1.0;
                }
            } else if (ruleType === 'factFeature') {
                ruleDefinition.value = document.getElementById('factValue').value || 'true';
                ruleDefinition.trainOnCondition = document.getElementById('trainOnCondition').value || 'true';
                ruleDefinition.actOnCondition = document.getElementById('actOnCondition').value || 'true';
                ruleDefinition.suppressThreshold = document.getElementById('suppressThreshold').value;
                
                // Add suppress scope
                const suppressScope = document.getElementById('suppressScope').value;
                if (suppressScope) {
                    ruleDefinition.suppressScope = suppressScope;
                }
            } else if (ruleType === 'contextFeature') {
                ruleDefinition.value = document.getElementById('contextValue').value;
                
                const trainOn = document.getElementById('trainOnCondition').value;
                if (trainOn) ruleDefinition.trainOnCondition = trainOn;
                
                const actOn = document.getElementById('actOnCondition').value;
                if (actOn) ruleDefinition.actOnCondition = actOn;
            }
            
            // Create final JSON structure
            const ruleJSON = {
                version: "1",
                ruleDefinitions: [ruleDefinition]
            };
            
            // Display JSON
            document.getElementById('jsonOutput').textContent = JSON.stringify(ruleJSON, null, 2);
            
            // Generate summary
            const activityType = document.getElementById('activityType').value || 'N/A';
            const summary = `
                <strong>Type:</strong> ${ruleType}<br>
                <strong>Template ID:</strong> ${templateId}<br>
                <strong>Name:</strong> ${ruleDefinition.name}<br>
                <strong>Activity Type:</strong> ${activityType}<br>
                <strong>Family:</strong> ${ruleDefinition.familyId}<br>
                <strong>Required Fields:</strong> ${requiredFields.join(', ') || 'None'}<br>
                <strong>Use Cases:</strong> ${useCases.join(', ') || 'None'}<br>
                <strong>MITRE Techniques:</strong> ${mitreMappings.map(m => m.techniqueKey).join(', ') || 'None'}
            `;
            document.getElementById('ruleSummary').innerHTML = summary;
        }

        function copyJSON() {
            const jsonText = document.getElementById('jsonOutput').textContent;
            navigator.clipboard.writeText(jsonText).then(() => {
                const toast = document.getElementById('toast');
                toast.textContent = 'JSON copied to clipboard!';
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2000);
            });
        }

        function downloadJSON() {
            const jsonText = document.getElementById('jsonOutput').textContent;
            const blob = new Blob([jsonText], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            
            const ruleName = document.getElementById('ruleName').value || 'rule';
            const filename = ruleName.toLowerCase().replace(/[^a-z0-9]/g, '_') + '.json';
            a.download = filename;
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialize: load CSVs, then populate and show
        (async () => {
            await loadFamilies();
            await loadGroups();
            populateFamilies();
            showStep(1);
        })();
        
        // Initialize chip click handlers after DOM is ready
        setTimeout(() => {
            document.querySelectorAll('.chip[data-copy]').forEach(chip => {
                chip.onclick = function() {
                    const textToCopy = this.getAttribute('data-copy');
                    copyToClipboard.call(this, textToCopy);
                };
            });
            
            // Initialize progress step click handlers
            document.querySelectorAll('.progress-step').forEach(step => {
                step.addEventListener('click', function() {
                    const targetStep = parseInt(this.getAttribute('data-step'));
                    goToStep(targetStep);
                });
            });
            
        }, 100);
    </script>
</body>
</html>